"use strict";var nanoid=require("nanoid"),Papa=require("papaparse"),dayjs=require("dayjs"),JSZip=require("@progress/jszip-esm"),exceljs=require("@zwight/exceljs"),core=require("@univerjs/core");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var Papa__default=_interopDefaultLegacy(Papa),dayjs__default=_interopDefaultLegacy(dayjs),JSZip__default=_interopDefaultLegacy(JSZip),exceljs__default=_interopDefaultLegacy(exceljs);const columeHeader_word=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],columeHeader_word_index={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25},coreFile="docProps/core.xml",stylesFile="xl/styles.xml";let numFmtDefault={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"yyyy/m/d",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"yyyy/m/d h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@"};const indexedColors={0:"00000000",1:"00FFFFFF",2:"00FF0000",3:"0000FF00",4:"000000FF",5:"00FFFF00",6:"00FF00FF",7:"0000FFFF",8:"00000000",9:"00FFFFFF",10:"00FF0000",11:"0000FF00",12:"000000FF",13:"00FFFF00",14:"00FF00FF",15:"0000FFFF",16:"00800000",17:"00008000",18:"00000080",19:"00808000",20:"00800080",21:"00008080",22:"00C0C0C0",23:"00808080",24:"009999FF",25:"00993366",26:"00FFFFCC",27:"00CCFFFF",28:"00660066",29:"00FF8080",30:"000066CC",31:"00CCCCFF",32:"00000080",33:"00FF00FF",34:"00FFFF00",35:"0000FFFF",36:"00800080",37:"00800000",38:"00008080",39:"000000FF",40:"0000CCFF",41:"00CCFFFF",42:"00CCFFCC",43:"00FFFF99",44:"0099CCFF",45:"00FF99CC",46:"00CC99FF",47:"00FFCC99",48:"003366FF",49:"0033CCCC",50:"0099CC00",51:"00FFCC00",52:"00FF9900",53:"00FF6600",54:"00666699",55:"00969696",56:"00003366",57:"00339966",58:"00003300",59:"00333300",60:"00993300",61:"00993366",62:"00333399",63:"00333333",64:null,65:null},borderTypes={none:0,thin:1,hair:2,dotted:3,dashed:4,dashDot:5,dashDotDot:6,double:7,medium:8,mediumDashed:9,mediumDashDot:10,mediumDashDotDot:11,slantDashDot:12,thick:13};let numFmtDefaultMap={"yyyy/m/d;@":"yyyy/MM/dd","yyyy&quot;\u5e74&quot;m&quot;\u6708&quot;d&quot;\u65e5&quot;;@":"yyyy&quot;\u5e74&quot;MM&quot;\u6708&quot;dd&quot;\u65e5&quot;","[$-409]yyyy/m/d\\ h:mm\\ AM/PM;@":"yyyy/MM/dd hh:mm AM/PM"};const fontFamilys={0:"defualt",1:"Roman",2:"Swiss",3:"Modern",4:"Script",5:"Decorative"},DATA_VERIFICATION_MAP={list:"dropdown",whole:"number_integer",decimal:"number_decimal",custom:"text_content",textLength:"text_length",date:"date",unknown1:"number",unknown2:"checkbox",unknown3:"validity"},COMMON_TYPE2=["number","number_integer","number_decimal","text_length"],DATA_VERIFICATION_TYPE2_MAP={common:{between:"bw",notBetween:"nb",equal:"eq",notEqualTo:"ne",moreThanThe:"gt",lessThan:"lt",greaterOrEqualTo:"gte",lessThanOrEqualTo:"lte"},text_content:{include:"include",exclude:"exclude",equal:"equal"},date:{between:"bw",notBetween:"nb",equal:"eq",notEqualTo:"ne",earlierThan:"bf",noEarlierThan:"nbf",laterThan:"af",noLaterThan:"naf"},validity:{card:"card",phone:"phone"}};var ChartAttributeBits,ChartTypeBits,LabelContentType;function getcellrange(e){let t=e.split("!"),l="";if(t.length>1?(t[0],l=t[1]):l=t[0],-1==l.indexOf(":")){let e=parseInt(l.replace(/[^0-9]/g,""))-1,t=ABCatNum(l.replace(/[^A-Za-z]/g,""));return isNaN(e)||isNaN(t)?null:{row:[e,e],column:[t,t]}}{let e=l.split(":"),t=[],n=[];return t[0]=parseInt(e[0].replace(/[^0-9]/g,""))-1,t[1]=parseInt(e[1].replace(/[^0-9]/g,""))-1,t[0]>t[1]?null:(n[0]=ABCatNum(e[0].replace(/[^A-Za-z]/g,"")),n[1]=ABCatNum(e[1].replace(/[^A-Za-z]/g,"")),n[0]>n[1]?null:{row:t,column:n})}}function ABCatNum(e){let t=(e=e.toUpperCase()).length;if(0==t)return NaN;let l=e.split(""),n=columeHeader_word.length,r=0;for(let e=t-1;e>=0;e--)r+=e==t-1?columeHeader_word_index[l[e]]:Math.pow(n,t-e-1)*(columeHeader_word_index[l[e]]+1);return r}function chatatABC(e){let t=columeHeader_word.length;if(e<t)return columeHeader_word[e];{let l=0,n="",r=1,i=0;for(;e>=t/(t-1)*(Math.pow(t,r++)-1);)i=r;l=e-t/(t-1)*(Math.pow(t,i-1)-1)+1;for(let e=i;e>0;e--){let r=l;if(1==e)return r%=t,0==r&&(r=26),n+columeHeader_word[r-1];r=Math.ceil(r/Math.pow(t,e-1)),n+=columeHeader_word[r-1],e>1&&(l-=(r-1)*t)}}}function getPxByEMUs(e){return null==e?0:e/914400*72/.75}function getEmusByPx(e){return.75*e/72*914400}function getXmlAttibute(e,t,l){let n=e[t];return n=null==n?l:n,n}function getColumnWidthPixel(e){return Math.round(8*(e-.83)+5)}function getRowHeightPixel(e){return Math.round(e/.75)}function hexToRgbArray(e){var t=e.toLowerCase();if(t&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(4===t.length){for(var l="#",n=1;n<4;n+=1)l+=t.slice(n,n+1).concat(t.slice(n,n+1));t=l}var r=[];for(n=1;n<7;n+=2)r.push(parseInt("0x"+t.slice(n,n+2)));return r}return null}function generateRandomIndex(e){null==e&&(e="Sheet");let t=navigator.userAgent.replace(/[^a-zA-Z0-9]/g,"").split(""),l="";for(let e=0;e<5;e++)l+=t[Math.round(Math.random()*(t.length-1))];return e+"_"+l+"_"+(new Date).getTime()}function escapeCharacter(e){return null==e||0==e.length?e:e.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&apos;/g,"'").replace(/&iexcl;/g,"\xa1").replace(/&cent;/g,"\xa2").replace(/&pound;/g,"\xa3").replace(/&curren;/g,"\xa4").replace(/&yen;/g,"\xa5").replace(/&brvbar;/g,"\xa6").replace(/&sect;/g,"\xa7").replace(/&uml;/g,"\xa8").replace(/&copy;/g,"\xa9").replace(/&ordf;/g,"\xaa").replace(/&laquo;/g,"\xab").replace(/&not;/g,"\xac").replace(/&shy;/g,"\xad").replace(/&reg;/g,"\xae").replace(/&macr;/g,"\xaf").replace(/&deg;/g,"\xb0").replace(/&plusmn;/g,"\xb1").replace(/&sup2;/g,"\xb2").replace(/&sup3;/g,"\xb3").replace(/&acute;/g,"\xb4").replace(/&micro;/g,"\xb5").replace(/&para;/g,"\xb6").replace(/&middot;/g,"\xb7").replace(/&cedil;/g,"\xb8").replace(/&sup1;/g,"\xb9").replace(/&ordm;/g,"\xba").replace(/&raquo;/g,"\xbb").replace(/&frac14;/g,"\xbc").replace(/&frac12;/g,"\xbd").replace(/&frac34;/g,"\xbe").replace(/&iquest;/g,"\xbf").replace(/&times;/g,"\xd7").replace(/&divide;/g,"\xf7").replace(/&Agrave;/g,"\xc0").replace(/&Aacute;/g,"\xc1").replace(/&Acirc;/g,"\xc2").replace(/&Atilde;/g,"\xc3").replace(/&Auml;/g,"\xc4").replace(/&Aring;/g,"\xc5").replace(/&AElig;/g,"\xc6").replace(/&Ccedil;/g,"\xc7").replace(/&Egrave;/g,"\xc8").replace(/&Eacute;/g,"\xc9").replace(/&Ecirc;/g,"\xca").replace(/&Euml;/g,"\xcb").replace(/&Igrave;/g,"\xcc").replace(/&Iacute;/g,"\xcd").replace(/&Icirc;/g,"\xce").replace(/&Iuml;/g,"\xcf").replace(/&ETH;/g,"\xd0").replace(/&Ntilde;/g,"\xd1").replace(/&Ograve;/g,"\xd2").replace(/&Oacute;/g,"\xd3").replace(/&Ocirc;/g,"\xd4").replace(/&Otilde;/g,"\xd5").replace(/&Ouml;/g,"\xd6").replace(/&Oslash;/g,"\xd8").replace(/&Ugrave;/g,"\xd9").replace(/&Uacute;/g,"\xda").replace(/&Ucirc;/g,"\xdb").replace(/&Uuml;/g,"\xdc").replace(/&Yacute;/g,"\xdd").replace(/&THORN;/g,"\xde").replace(/&szlig;/g,"\xdf").replace(/&agrave;/g,"\xe0").replace(/&aacute;/g,"\xe1").replace(/&acirc;/g,"\xe2").replace(/&atilde;/g,"\xe3").replace(/&auml;/g,"\xe4").replace(/&aring;/g,"\xe5").replace(/&aelig;/g,"\xe6").replace(/&ccedil;/g,"\xe7").replace(/&egrave;/g,"\xe8").replace(/&eacute;/g,"\xe9").replace(/&ecirc;/g,"\xea").replace(/&euml;/g,"\xeb").replace(/&igrave;/g,"\xec").replace(/&iacute;/g,"\xed").replace(/&icirc;/g,"\xee").replace(/&iuml;/g,"\xef").replace(/&eth;/g,"\xf0").replace(/&ntilde;/g,"\xf1").replace(/&ograve;/g,"\xf2").replace(/&oacute;/g,"\xf3").replace(/&ocirc;/g,"\xf4").replace(/&otilde;/g,"\xf5").replace(/&ouml;/g,"\xf6").replace(/&oslash;/g,"\xf8").replace(/&ugrave;/g,"\xf9").replace(/&uacute;/g,"\xfa").replace(/&ucirc;/g,"\xfb").replace(/&uuml;/g,"\xfc").replace(/&yacute;/g,"\xfd").replace(/&thorn;/g,"\xfe").replace(/&yuml;/g,"\xff")}!function(e){e[e.Stack=1073741824]="Stack",e[e.PercentStack=1610612736]="PercentStack",e[e.Horizontal=268435456]="Horizontal"}(ChartAttributeBits||(ChartAttributeBits={})),function(e){e[e.None=0]="None",e[e.Line=2]="Line",e[e.Column=4]="Column",e[e.ColumnStacked=1073741828]="ColumnStacked",e[e.ColumnPercentStacked=1610612740]="ColumnPercentStacked",e[e.Bar=268435460]="Bar",e[e.BarStacked=1342177284]="BarStacked",e[e.BarPercentStacked=1879048196]="BarPercentStacked",e[e.Pie=8]="Pie",e[e.Doughnut=264]="Doughnut",e[e.Area=16]="Area",e[e.AreaStacked=1073741840]="AreaStacked",e[e.AreaPercentStacked=1610612752]="AreaPercentStacked",e[e.Radar=32]="Radar",e[e.Scatter=64]="Scatter",e[e.Combination=128]="Combination"}(ChartTypeBits||(ChartTypeBits={})),function(e){e[e.Empty=0]="Empty",e[e.CategoryName=2]="CategoryName",e[e.SeriesName=4]="SeriesName",e[e.Value=8]="Value",e[e.Percentage=16]="Percentage"}(LabelContentType||(LabelContentType={}));class fromulaRef{static trim(e){return null==e&&(e=""),e.replace(/(^\s*)|(\s*$)/g,"")}static functionCopy(e,t,l){let n=this;if(null==n.operatorjson){let e=n.operator.split("|"),t={};for(let l=0;l<e.length;l++)t[e[l].toString()]=1;n.operatorjson=t}null==t&&(t="down"),null==l&&(l=1),"="==e.substr(0,1)&&(e=e.substr(1));let r=e.split(""),i=0,a="",s="",o={bracket:0,comma:0,squote:0,dquote:0};for(;i<r.length;){let e=r[i];if("("==e&&0==o.dquote)o.bracket+=1,a.length>0?s+=a+"(":s+="(",a="";else if(")"==e&&0==o.dquote)o.bracket-=1,s+=n.functionCopy(a,t,l)+")",a="";else if('"'==e&&0==o.squote)o.dquote>0?(s+=a+'"',o.dquote-=1,a=""):(o.dquote+=1,a+='"');else if(","==e&&0==o.dquote)s+=n.functionCopy(a,t,l)+",",a="";else if("&"==e&&0==o.dquote)a.length>0?(s+=n.functionCopy(a,t,l)+"&",a=""):s+="&";else if(e in n.operatorjson&&0==o.dquote){let o="";i+1<r.length&&(o=r[i+1]);let c=i-1,u=null;if(c>=0)do{u=r[c--]}while(c>=0&&" "==u);e+o in n.operatorjson?(a.length>0?(s+=n.functionCopy(a,t,l)+e+o,a=""):s+=e+o,i++):/[^0-9]/.test(o)||"-"!=e||"("!=u&&null!=u&&","!=u&&" "!=u&&!(u in n.operatorjson)?a.length>0?(s+=n.functionCopy(a,t,l)+e,a=""):s+=e:a+=e}else a+=e;i==r.length-1&&(n.iscelldata(n.trim(a))?"down"==t?s+=n.downparam(n.trim(a),l):"up"==t?s+=n.upparam(n.trim(a),l):"left"==t?s+=n.leftparam(n.trim(a),l):"right"==t&&(s+=n.rightparam(n.trim(a),l)):s+=n.trim(a)),i++}return s}static downparam(e,t){return this.updateparam("d",e,t)}static upparam(e,t){return this.updateparam("u",e,t)}static leftparam(e,t){return this.updateparam("l",e,t)}static rightparam(e,t){return this.updateparam("r",e,t)}static updateparam(e,t,l){let n,r=this,i=t.split("!"),a="";if(i.length>1?(n=i[1],a=i[0]+"!"):n=i[0],-1==n.indexOf(":")){let i=parseInt(n.replace(/[^0-9]/g,"")),s=ABCatNum(n.replace(/[^A-Za-z]/g,"")),o=isfreezonFuc(n),c=o[0]?"$":"",u=o[1]?"$":"";return"u"!=e||o[0]?"r"!=e||o[1]?"l"!=e||o[1]?o[0]||(i+=l):s-=l:s+=l:i-=l,i<0||s<0?r.error.r:isNaN(i)||isNaN(s)?isNaN(i)?isNaN(s)?t:a+u+chatatABC(s):a+c+i:a+u+chatatABC(s)+c+i}{n=n.split(":");let i=[],s=[];if(i[0]=parseInt(n[0].replace(/[^0-9]/g,"")),i[1]=parseInt(n[1].replace(/[^0-9]/g,"")),i[0]>i[1])return t;if(s[0]=ABCatNum(n[0].replace(/[^A-Za-z]/g,"")),s[1]=ABCatNum(n[1].replace(/[^A-Za-z]/g,"")),s[0]>s[1])return t;let o=isfreezonFuc(n[0]),c=isfreezonFuc(n[1]),u=o[0]?"$":"",h=o[1]?"$":"",g=c[0]?"$":"",f=c[1]?"$":"";return"u"==e?(o[0]||(i[0]-=l),c[0]||(i[1]-=l)):"r"==e?(o[1]||(s[0]+=l),c[1]||(s[1]+=l)):"l"==e?(o[1]||(s[0]-=l),c[1]||(s[1]-=l)):(o[0]||(i[0]+=l),c[0]||(i[1]+=l)),i[0]<0||s[0]<0?r.error.r:isNaN(s[0])&&isNaN(s[1])?a+u+i[0]+":"+g+i[1]:isNaN(i[0])&&isNaN(i[1])?a+h+chatatABC(s[0])+":"+f+chatatABC(s[1]):a+h+chatatABC(s[0])+u+i[0]+":"+f+chatatABC(s[1])+g+i[1]}}static iscelldata(e){let t,l=e.split("!");t=l.length>1?l[1]:l[0];let n=/^(([a-zA-Z]+)|([$][a-zA-Z]+))(([0-9]+)|([$][0-9]+))$/g,r=/^(((([a-zA-Z]+)|([$][a-zA-Z]+))(([0-9]+)|([$][0-9]+)))|((([a-zA-Z]+)|([$][a-zA-Z]+))))$/g;if(-1==t.indexOf(":")){let e=parseInt(t.replace(/[^0-9]/g,""))-1,l=ABCatNum(t.replace(/[^A-Za-z]/g,""));return!(isNaN(e)||isNaN(l)||!t.toString().match(n))||!!isNaN(e)&&(isNaN(l),!1)}{r=/^(((([a-zA-Z]+)|([$][a-zA-Z]+))(([0-9]+)|([$][0-9]+)))|((([a-zA-Z]+)|([$][a-zA-Z]+)))|((([0-9]+)|([$][0-9]+s))))$/g,t=t.split(":");let e=[],l=[];return e[0]=parseInt(t[0].replace(/[^0-9]/g,""))-1,e[1]=parseInt(t[1].replace(/[^0-9]/g,""))-1,!(e[0]>e[1]||(l[0]=ABCatNum(t[0].replace(/[^A-Za-z]/g,"")),l[1]=ABCatNum(t[1].replace(/[^A-Za-z]/g,"")),l[0]>l[1]||!t[0].toString().match(r)||!t[1].toString().match(r)))}}}function isChinese(e){return!!/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/.test(e)||!/[^\u4e00-\u9fa5]/.test(e)}function isJapanese(e){return!/[^\u0800-\u4e00]/.test(e)}function isKoera(e){return e>12592&&e<12687||e>=44032&&e<=55203}function getMultiSequenceToNum(e){if(!e||e?.length<=0)return[];let t=(n=(e=e.toUpperCase()).split(" ").filter(e=>e&&e.trim()),n?.map(e=>{if(e.includes(":")){let t=e.split(":");2===t?.length&&(n=n.concat(function(e){let t=[];const l=new RegExp(/[A-Z]+|[0-9]+/g),n=e[0]?.match(l),r=e[1]?.match(l),i=Math.max(ABCatNum(n[0]),ABCatNum(r[0])),a=Math.min(ABCatNum(n[0]),ABCatNum(r[0])),s=Math.max(parseInt(n[1]),parseInt(r[1])),o=Math.min(parseInt(n[1]),parseInt(r[1]));for(let e=a;e<=i;e++)for(let l=o;l<=s;l++)t.push(`${chatatABC(e)}${l}`);return t}(t))).splice(n.indexOf(e),1)}}),n.filter((e,t,l)=>l.indexOf(e)===t)),l=[];var n;for(let e=0;e<t.length;e++){let n=getSingleSequenceToNum(t[e]);n&&l.push(n)}return l}function getSingleSequenceToNum(e){let t=e.match(/[A-Z]+|[0-9]+/g),l=t.length,n=new RegExp("^[A-Z]+$"),r="";for(let e=l-1;e>=0;e--){let l=t[e];n.test(l)?r+=ABCatNum(l)+"_":r+=parseInt(l)-1+"_"}return r.substring(0,r.length-1)}function getTransR1C1ToSequence(e){if(!e&&e?.length<=0)return"";const t=e.length,l=e.lastIndexOf("!"),n=[e.slice(0,l),e.slice(l+1,t)],r=n[1]||"",i=r.indexOf("R"),a=r.indexOf("C"),s=Number(r.slice(i+1,a)),o=chatatABC(Number(r.slice(a+1,r?.length))-1);return`${n[0]}!${o}${s}`}function getPeelOffX14(e){if(!e||e?.length<=0)return{};const t=new RegExp("</x14:formula[^]>","g"),l=e.match(t)?.length,n=`</x14:formula${l}>`,r=e.indexOf(n);let i=e.substring(0,r+n.length);i=i.replace(/<xm:f>/g,"").replace(/<\/xm:f>/g,"").replace(/x14:/g,"").replace(/\/x14:/g,"");const a=i,s=e.indexOf("<xm:sqref>"),o=e.indexOf("</xm:sqref>");return{formula:a,sqref:e.substring(s+10,o)}}function getMultiFormulaValue(e){if(!e||e?.length<=0)return[];const t=new RegExp("formula","g"),l=(e.match(t)?.length||0)/2;if(0===l)return[];let n=[];for(let t=1;t<=l;t++){const l=`<formula${t}>`?.length,r=e.indexOf(`<formula${t}>`),i=e.indexOf(`</formula${t}>`),a=e.substring(r+l,i);n.push(escapeCharacter(a.replace(/&quot;|^\"|\"$/g,"")))}return n}function isfreezonFuc(e){let t=e.replace(/[^0-9]/g,""),l=e.replace(/[^A-Za-z]/g,""),n=e.substr(e.indexOf(t)-1,1),r=e.substr(e.indexOf(l)-1,1),i=[!1,!1];return"$"==n&&(i[0]=!0),"$"==r&&(i[1]=!0),i}function ABCToNumber(e){if(null==e||0===e.length)return Number.NaN;const t=e.toLowerCase().split(""),l=t.length,n=e=>e.charCodeAt(0)-96;let r=0,i=0;for(let e=0;e<l;e++)i=n(t[e]),r+=i*26**(l-e-1);return 0===r?Number.NaN:r-1}fromulaRef.operator="==|!=|<>|<=|>=|=|+|-|>|<|/|*|%|&|^",fromulaRef.error={v:"#VALUE!",n:"#NAME?",na:"#N/A",r:"#REF!",d:"#DIV/0!",nm:"#NUM!",nl:"#NULL!",sp:"#SPILL!"},fromulaRef.operatorjson=null;const orderA="A".charCodeAt(0),orderZ="Z".charCodeAt(0);function numberToABC(e){const t=orderZ-orderA+1;let l="";for(;e>=0;)l=String.fromCharCode(e%t+orderA)+l,e=Math.floor(e/t)-1;return l}function str2num(e){if(null==e)return e;try{return Number.isNaN(Number(e))?e:Number(e)}catch(t){return e}}function generateRandomId(e=21,t){return t?nanoid.customAlphabet(t,e)():nanoid.nanoid(e)}function jsonParse(e){if(!e)return{};try{return JSON.parse(e)}catch(e){return null}}function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}function removeEmptyAttr$1(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?delete e[t]:isObject(e[t])&&null!==e[t]&&removeEmptyAttr$1(e[t]));return e}function isEmpty(e){return null==e}class xmloperation{getElementsByOneTag(e,t){let l;if(e.indexOf("|")>-1){let t=e.split("|"),n="";for(let e=0;e<t.length;e++){let l=t[e];n+="|<"+l+" [^>]+?[^/]>[\\s\\S]*?</"+l+">|<"+l+" [^>]+?/>|<"+l+">[\\s\\S]*?</"+l+">|<"+l+"/>"}n=n.substr(1,n.length),l=new RegExp(n,"g")}else l=new RegExp("<"+e+" [^>]+?[^/]>[\\s\\S]*?</"+e+">|<"+e+" [^>]+?/>|<"+e+">[\\s\\S]*?</"+e+">|<"+e+"/>","g");let n=t.match(l);return null==n?[]:n}getElementByTagLink(e,t){const l=(new DOMParser).parseFromString(t,"text/xml");let n=Array.from(l.children);if(e.indexOf("/")>-1){let t=e.split("/");for(let e=0;e<t.length;e++){const l=t[e],r=n.findIndex(e=>Array.from(e.children).findIndex(e=>e.tagName===l)>-1);if(-1===r&&e<=t.length-1)return[];n=Array.from(n[r].children).filter(e=>e.tagName===l)}}else n=Array.from(n[0].children).filter(t=>t.tagName===e);const r=new XMLSerializer;return n.map(e=>r.serializeToString(e))}}class ReadXml extends xmloperation{constructor(e){super(),this.originFile=e}getElementsByTagName(e,t,l=!0){let n=this.getFileByName(t);l||(n=t);let r,i=e.split("/");for(let e in i){let t=i[e];if(null==r)r=this.getElementsByOneTag(t,n);else if(r instanceof Array){let e=[];for(let l in r){let n=r[l];e=e.concat(this.getElementsByOneTag(t,n))}r=e}else r=this.getElementsByOneTag(t,r)}let a=[];for(let e=0;e<r.length;e++){let t=new Element(r[e]);a.push(t)}return a}getElementsByTagNameLink(e,t,l=!0){let n=this.getFileByName(t);l||(n=t);const r=this.getElementByTagLink(e,n);let i=[];for(let e=0;e<r.length;e++){let t=new Element(r[e]);i.push(t)}return i}getFileByName(e){for(let t in this.originFile)if(t.indexOf(e)>-1)return this.originFile[t];return""}}class Element extends xmloperation{constructor(e){super(),this.elementString=e,this.setValue();const t=new RegExp('[a-zA-Z0-9_:]*?=".*?"',"g");let l=this.container.match(t);if(this.attributeList={},null!=l)for(let e in l){let t=l[e];if(0==t.length)continue;let n=t.substr(0,t.indexOf("=")),r=t.substr(t.indexOf("=")+1);null!=n&&null!=r&&0!=n.length&&0!=r.length&&(this.attributeList[n]=r.substr(1,r.length-2))}}get(e){return this.attributeList[e]}getInnerElements(e){let t=this.getElementsByOneTag(e,this.elementString),l=[];for(let e=0;e<t.length;e++){let n=new Element(t[e]);l.push(n)}return 0==l.length?null:l}getInnerElementsTagLink(e){const t=this.getElementByTagLink(e,this.elementString);let l=[];for(let e=0;e<t.length;e++){let n=new Element(t[e]);l.push(n)}return 0==l.length?null:l}setValue(){let e=this.elementString;if("/>"==e.substr(e.length-2,2))this.value="",this.container=e;else{let t=this.getFirstTag(),l=new RegExp("(<"+t+" [^>]+?[^/]>)([\\s\\S]*?)</"+t+">|(<"+t+">)([\\s\\S]*?)</"+t+">","g").exec(e);null!=l&&(null!=l[1]?(this.container=l[1],this.value=l[2]):(this.container=l[3],this.value=l[4]))}}getFirstTag(){let e=this.elementString,t=e.substr(0,e.indexOf(" "));return(""==t||t.indexOf(">")>-1)&&(t=e.substr(0,e.indexOf(">"))),t=t.substr(1,t.length),t}}function getColor(e,t,l="g"){let n=e.attributeList,r=t.clrScheme,i=t.indexedColors;t.mruColors;let a,s=function(e,t){let l={};if(null==e||0==e.length)return t;for(let n in t){let r=t[n],i=e[parseInt(n)];if(null==i)l[n]=r;else{let e=i.attributeList.rgb;l[n]=e}}return l}(i,indexedColors),o=n.indexed,c=n.rgb,u=n.theme,h=n.tint;if(null!=o)a=s[parseInt(o)],null!=a&&(a=a.substring(a.length-6,a.length),a="#"+a);else if(null!=c)c=c.substring(c.length-6,c.length),a="#"+c;else if(null!=u){let e=parseInt(u);0==e?e=1:1==e?e=0:2==e?e=3:3==e&&(e=2);let t=r[e];if(null!=t){let e=t.getInnerElements("a:sysClr|a:srgbClr");if(null!=e){let t=e[0],l=t.attributeList;t.container.indexOf("sysClr")>-1?null!=l.lastClr?a="#"+l.lastClr:null!=l.val&&(a="#"+l.val):t.container.indexOf("srgbClr")>-1&&(a="#"+l.val)}}}if(null!=h){let e=parseFloat(h);null!=a&&(a=function(e,t){let l=e.substring(e.length-6,e.length),n=hexToRgbArray("#"+l),r=function(e,t,l){e/=255,t/=255,l/=255;var n,r,i=Math.max(e,t,l),a=Math.min(e,t,l),s=(i+a)/2;if(i==a)n=r=0;else{var o=i-a;switch(r=s>.5?o/(2-i-a):o/(i+a),i){case e:n=(t-l)/o+(t<l?6:0);break;case t:n=(l-e)/o+2;break;case l:n=(e-t)/o+4}n/=6}return[n,r,s]}(n[0],n[1],n[2]);if(t>0)r[2]=r[2]*(1-t)+t;else{if(!(t<0))return"#"+l;r[2]=r[2]*(1+t)}return function(e){if(/^(rgb|RGB)/.test(e)){for(var t=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),l="#",n=0;n<t.length;n++){var r=Number(t[n]).toString(16);r.length<2&&(r="0"+r),l+=r}return 7!==l.length&&(l=e),l}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){var i=e.replace(/#/,"").split("");if(6===i.length)return e;if(3===i.length){var a="#";for(n=0;n<i.length;n+=1)a+=i[n]+i[n];return a}}return e}("RGB("+function(e,t,l){var n,r,i;if(0==t)n=r=i=l;else{var a=function(e,t,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?e+6*(t-e)*l:l<.5?t:l<2/3?e+(t-e)*(2/3-l)*6:e},s=l<.5?l*(1+t):l+t-l*t,o=2*l-s;n=a(o,s,e+1/3),r=a(o,s,e),i=a(o,s,e-1/3)}return[Math.round(255*n),Math.round(255*r),Math.round(255*i)]}(r[0],r[1],r[2]).join(",")+")")}(a,e))}return a}function getlineStringAttr(e,t){let l,n=e.getInnerElements(t);if(null!=n&&n.length>0)if("b"==t||"i"==t||"strike"==t)l="1";else if("u"==t){let e=n[0].attributeList.val;l="double"==e?"2":"singleAccounting"==e?"3":"doubleAccounting"==e?"4":"1"}else if("vertAlign"==t){let e=n[0].attributeList.val;"subscript"==e?l="1":"superscript"==e&&(l="2")}else l=n[0].attributeList.val;return l}class LuckyFileBase{}class WorkBookInfo{}class LuckySheetBase{}class LuckyFileInfo{}class LuckySheetCelldataBase{}class LuckySheetCelldataValue{}class LuckySheetCellFormat{}class LuckyInlineString{}class LuckyConfig{}class LuckySheetborderInfoCellForImp{}class LuckySheetborderInfoCellValue{}class LuckySheetborderInfoCellValueStyle{}class LuckySheetConfigMerge{}class LuckysheetCalcChain{}class LuckyImageBase{}class LuckyChartImageBase{}class LuckyChart{}var AbsoluteRefType;function getBorderInfo(e,t){if(null==e)return null;let l=e[0],n=l.attributeList.style;if(null==n||"none"==n)return null;let r=l.getInnerElements("color"),i="#000000";null!=r&&(i=getColor(r[0],t,"b"),null==i&&(i="#000000"));let a=new LuckySheetborderInfoCellValueStyle;return a.style=borderTypes[n],a.color=i,a}function handleBorder(e,t){const l=new LuckySheetborderInfoCellValue;let n=!1;if(!e)return{borderCellValue:l,isAdd:n};let r=e.getInnerElements("left"),i=e.getInnerElements("right"),a=e.getInnerElements("top"),s=e.getInnerElements("bottom"),o=e.getInnerElements("diagonal"),c=e.getInnerElements("start"),u=e.getInnerElements("end"),h=getBorderInfo(r,t),g=getBorderInfo(i,t),f=getBorderInfo(a,t),m=getBorderInfo(s,t),d=getBorderInfo(o,t),p=getBorderInfo(c,t),E=getBorderInfo(u,t);if(null!=p&&null!=p.color&&(l.l=p,n=!0),null!=E&&null!=E.color&&(l.r=E,n=!0),null!=h&&null!=h.color&&(l.l=h,n=!0),null!=g&&null!=g.color&&(l.r=g,n=!0),null!=f&&null!=f.color&&(l.t=f,n=!0),null!=m&&null!=m.color&&(l.b=m,n=!0),null!=d&&null!=d.color){const t=e.attributeList.diagonalUp,r=e.attributeList.diagonalDown;"1"===t&&(l.bl_tr=d),"1"===r&&(l.tl_br=d),n=!0}return{borderCellValue:l,isAdd:n}}function getBackgroundByFill(e,t){let l=e.getInnerElements("patternFill");if(null!=l){let e,n,r=l[0],i=r.getInnerElements("fgColor"),a=r.getInnerElements("bgColor");if(null!=i&&(e=getColor(i[0],t)),null!=a&&(n=getColor(a[0],t)),null!=e)return e;if(null!=n)return n}else if(null!=e.getInnerElements("gradientFill"))return null}function getFontStyle(e,t){let l=null;const n=new LuckySheetCelldataValue;let r=e.getInnerElements("sz"),i=e.getInnerElements("color"),a=e.getInnerElements("name"),s=e.getInnerElements("family");e.getInnerElements("charset");let o=e.getInnerElements("b"),c=e.getInnerElements("i"),u=e.getInnerElements("strike"),h=e.getInnerElements("u");if(null!=r&&r.length>0){let e=r[0].attributeList.val;null!=e&&(n.fs=parseInt(e))}if(null!=i&&i.length>0){let e=getColor(i[0],t,"t");null!=e&&(n.fc=e)}if(null!=s&&s.length>0){let e=s[0].attributeList.val;null!=e&&(l=fontFamilys[e])}if(null!=a&&a.length>0){let e=a[0].attributeList.val;null!=e&&(n.ff=e)}if(null!=o&&o.length>0){let e=o[0].attributeList.val;n.bl="0"==e?0:1}if(null!=c&&c.length>0){let e=c[0].attributeList.val;n.it="0"==e?0:1}if(null!=u&&u.length>0){let e=u[0].attributeList.val;n.cl="0"==e?0:1}if(null!=h&&h.length>0){let e=h[0].attributeList.val;n.un="single"==e?1:"double"==e?2:"singleAccounting"==e?3:"doubleAccounting"==e?4:0}return{cellValue:n,familyFont:l}}!function(e){e[e.NONE=0]="NONE",e[e.ROW=1]="ROW",e[e.COLUMN=2]="COLUMN",e[e.ALL=3]="ALL"}(AbsoluteRefType||(AbsoluteRefType={}));const handleRanges=e=>e.split(" ").map(e=>{const t=e.split(":"),l=parseInt(t[0].replace(/[^0-9]/g,""))-1,n=ABCToNumber(t[0].replace(/[^A-Za-z]/g,"")),r=isfreezonFuc(t[0]),i=1===t.length?l:parseInt(t[1].replace(/[^0-9]/g,""))-1,a=1===t.length?n:ABCToNumber(t[1].replace(/[^A-Za-z]/g,"")),s=1===t.length?r:isfreezonFuc(t[1]),o=e=>!0===e[0]&&!0===e[1]?AbsoluteRefType.ALL:!0===e[0]?AbsoluteRefType.ROW:!0===e[1]?AbsoluteRefType.COLUMN:AbsoluteRefType.NONE;return{startRow:l,startColumn:n,endRow:i,endColumn:a,startAbsoluteRefType:o(r),endAbsoluteRefType:o(s),rangeType:0}});var CHARSET_TYPE;!function(e){e.UTF8="UTF-8",e.GBK="GBK",e.CP936="CP936",e.ISO8859="ISO-8859"}(CHARSET_TYPE||(CHARSET_TYPE={}));const replaceSpecialWrap=e=>e.replace(/_x000D_/g,"").replace(/&#13;&#10;/g,"\r\n").replace(/&#13;/g,"\r").replace(/&#10;/g,"\n");class LuckySheetCelldata extends LuckySheetCelldataBase{constructor(e,t,l,n,r,i,a,s,o){super(),this.cell=e,this.sheetFile=i,this.styles=l,this.sharedStrings=n,this.readXml=o,this.mergeCells=r,this.cellImages=a,this.imageList=s,this.cellSize=t;let c=e.attributeList,u=c.r,h=c.s,g=c.t,f=getcellrange(u);this.r=f.row[0],this.c=f.column[0],this.v=this.generateValue(h,g)}generateValue(e,t){let l=this.cell.getInnerElements("v"),n=this.cell.getInnerElements("f");null==l&&(l=this.cell.getInnerElements("t"));let r=this.styles.cellXfs,i=this.styles.cellStyleXfs;this.styles.cellStyles;let a=this.styles.fonts,s=this.styles.fills,o=this.styles.borders,c=this.styles.numfmts;this.styles.clrScheme;let u=this.sharedStrings,h=new LuckySheetCelldataValue;if(null!=n){let e=n[0].attributeList,t=e.t,l=e.ref,r=e.si,i=n[0].value;"shared"==t&&(this._fomulaRef=l,this._formulaType=t,this._formulaSi=r),(null!=l||null!=i&&i.length>0)&&(i=escapeCharacter(i),h.f="="===i[0]?i:"="+i)}let g,f=null;if(null!=e){let l,n,u,m,d,p,E,y,b,T=r[parseInt(e)],C=T.attributeList.xfId;if(null!=C){let e=i[parseInt(C)],t=e.attributeList,r=t.applyNumberFormat,a=t.applyFont,s=t.applyFill,o=t.applyBorder,c=t.applyAlignment;if(t.applyProtection,g=t.quotePrefix,"0"!=r&&null!=t.numFmtId&&(l=t.numFmtId),"0"!=a&&null!=t.fontId&&(n=t.fontId),"0"!=s&&null!=t.fillId&&(u=t.fillId),"0"!=o&&null!=t.borderId&&(m=t.borderId),null!=c&&"0"!=c){let t=e.getInnerElements("alignment");if(null!=t){let e=t[0].attributeList;null!=e.horizontal&&(d=e.horizontal),null!=e.vertical&&(p=e.vertical),null!=e.wrapText&&(E=e.wrapText),null!=e.textRotation&&(y=e.textRotation),null!=e.shrinkToFit&&e.shrinkToFit,null!=e.indent&&(b=e.indent)}}}let I=T.attributeList.applyNumberFormat,v=T.attributeList.applyFont,R=T.attributeList.applyFill,w=T.attributeList.applyBorder,L=T.attributeList.applyAlignment;if(null!=T.attributeList.applyProtection&&T.attributeList.applyProtection,null!=T.attributeList.quotePrefix&&(g=T.attributeList.quotePrefix),"0"!=I&&null!=T.attributeList.numFmtId&&(l=T.attributeList.numFmtId),"0"!=v&&(n=T.attributeList.fontId),"0"!=R&&(u=T.attributeList.fillId),"0"!=w&&(m=T.attributeList.borderId),"0"!=L){let e=T.getInnerElements("alignment");if(null!=e&&e.length>0){let t=e[0].attributeList;null!=t.horizontal&&(d=t.horizontal),null!=t.vertical&&(p=t.vertical),null!=t.wrapText&&(E=t.wrapText),null!=t.textRotation&&(y=t.textRotation),null!=t.shrinkToFit&&t.shrinkToFit,null!=t.indent&&(b=t.indent)}}if(null!=l){let e=c[parseInt(l)],n=new LuckySheetCellFormat;n.fa=escapeCharacter(e),n.t=t||"d",h.ct=n}if(null!=u){let e=getBackgroundByFill(s[parseInt(u)],this.styles);null!=e&&(h.bg=e)}if(null!=n){let e=a[parseInt(n)];if(null!=e){const{cellValue:t,familyFont:l}=getFontStyle(e,this.styles);h={...h,...t},f=l}}if(null!=d&&(h.ht="center"==d||"centerContinuous"==d?0:"left"==d?1:"right"==d?2:"distributed"==d?0:"fill"==d||"general"==d?1:"justify"==d?0:1),h.vt=null!=p?"bottom"==p?2:"center"==p||"distributed"==p||"justify"==p?0:1:2,h.tb=null!=E&&"1"==E?2:1,null!=y&&("255"==y?h.tr=3:(h.tr=0,h.rt=parseInt(y))),null!=b){const e=parseInt(b);isNaN(e)||(h.ti=e)}if(null!=m){let e=o[parseInt(m)],t=new LuckySheetborderInfoCellForImp;t.rangeType="cell";const{isAdd:l,borderCellValue:n}=handleBorder(e,this.styles);n.row_index=this.r,n.col_index=this.c,l&&(t.value=n,this._borderObject=t)}}else h.tb=1;if(null!=l){let e=l[0].value;/&#\d+;/.test(e)&&(e=this.htmlDecode(e));const n=e=>{let t=e.getInnerElements("r");if(null==t){let t=e.getInnerElements("t");if(null!=t){let e="";if(t.forEach(t=>{e+=t.value}),e=escapeCharacter(e),/&#\d+;/.test(e)&&(e=this.htmlDecode(e)),"Roman"==f&&e.length>0){let t=e.split(""),l=null,n="",r=null,i="Times New Roman";null!=h.ff&&(i=h.ff);let a=h.ct;null==a&&(a=new LuckySheetCellFormat),null==a.s&&(a.s=[]);for(let e=0;e<t.length;e++){let s=t[e],o=null,c=i;if(isChinese(s)?(o="c",c="\u5b8b\u4f53"):isJapanese(s)?(o="j",c="Yu Gothic"):isKoera(s)?(o="k",c="Malgun Gothic"):o="e",o!=l&&null!=l||e==t.length-1){let i=new LuckyInlineString;if(i.ff=r,null!=h.fc&&(i.fc=h.fc),null!=h.fs&&(i.fs=h.fs),null!=h.cl&&(i.cl=h.cl),null!=h.un&&(i.un=h.un),null!=h.bl&&(i.bl=h.bl),null!=h.it&&(i.it=h.it),e==t.length-1){if(o!=l){i.ff=r,i.v=n,a.s.push(i);let e=new LuckyInlineString;e.ff=c,e.v=s,null!=h.fc&&(e.fc=h.fc),null!=h.fs&&(e.fs=h.fs),null!=h.cl&&(e.cl=h.cl),null!=h.un&&(e.un=h.un),null!=h.bl&&(e.bl=h.bl),null!=h.it&&(e.it=h.it),a.s.push(e);break}i.ff=c,i.v=n+s}else i.v=n;a.s.push(i),n=s}else n+=s;l=o,r=c}a.t="inlineStr",h.ct=a}else if(e=replaceSpecialWrap(e),e.indexOf("\r\n")>-1||e.indexOf("\n")>-1){let t=new LuckyInlineString;t.v=e;let l=h.ct;null==l&&(l=new LuckySheetCellFormat),null!=h.ff&&(t.ff=h.ff),null!=h.fc&&(t.fc=h.fc),null!=h.fs&&(t.fs=h.fs),null!=h.cl&&(t.cl=h.cl),null!=h.un&&(t.un=h.un),null!=h.bl&&(t.bl=h.bl),null!=h.it&&(t.it=h.it),l.t="inlineStr",l.s=[t],h.ct=l}else h.v=e,g="1"}}else{let e=[];t.forEach(t=>{let l=t.getInnerElements("t"),n=t.getInnerElements("rPr"),r=new LuckyInlineString;if(null!=l&&l.length>0){let e=l[0].value;e=replaceSpecialWrap(e),e=escapeCharacter(e),r.v=e}if(null!=n&&n.length>0){let e=n[0],t=getlineStringAttr(e,"sz"),l=getlineStringAttr(e,"rFont");getlineStringAttr(e,"family"),getlineStringAttr(e,"charset"),getlineStringAttr(e,"scheme");let i,a,s=getlineStringAttr(e,"b"),o=getlineStringAttr(e,"i"),c=getlineStringAttr(e,"u"),u=getlineStringAttr(e,"strike"),g=getlineStringAttr(e,"vertAlign"),f=e.getInnerElements("color");null!=f&&f.length>0&&(i=getColor(f[0],this.styles,"t")),null!=l&&(a=l),null!=a?r.ff=a:null!=h.ff&&(r.ff=h.ff),null!=i&&(r.fc=i),null!=t?r.fs=parseInt(t):null!=h.fs&&(r.fs=h.fs),null!=u?r.cl=parseInt(u):null!=h.cl&&(r.cl=h.cl),null!=c?r.un=parseInt(c):null!=h.un&&(r.un=h.un),null!=s?r.bl=parseInt(s):null!=h.bl&&(r.bl=h.bl),null!=o?r.it=parseInt(o):null!=h.it&&(r.it=h.it),null!=g&&(r.va=parseInt(g))}else null==r.ff&&null!=h.ff&&(r.ff=h.ff),null==r.fc&&null!=h.fc&&(r.fc=h.fc),null==r.fs&&null!=h.fs&&(r.fs=h.fs),null==r.cl&&null!=h.cl&&(r.cl=h.cl),null==r.un&&null!=h.un&&(r.un=h.un),null==r.bl&&null!=h.bl&&(r.bl=h.bl),null==r.it&&null!=h.it&&(r.it=h.it);e.push(r)});let l=h.ct;null==l&&(l=new LuckySheetCellFormat),l.t="inlineStr",l.s=e,h.ct=l}};if("s"==t)n(u[parseInt(l[0].value)]);else if("inlineStr"==t&&null!=l){h.v=this.htmlDecode(e);let t=h.ct;null==t&&(t=new LuckySheetCellFormat),t.t="s",h.ct=t;let l=this.cell.getInnerElements("is");l.length&&n(l[0])}else if("str"==t&&e.includes("=DISPIMG")){let t=h.ct;null==t&&(t=new LuckySheetCellFormat),t.t="str",t.ci=this.getCellImage(h,e),h.ct=t}else e=escapeCharacter(e),h.v=e}if(null!=g&&(h.qp=parseInt(g)),null!==t&&!h.ct?.t){let e=new LuckySheetCellFormat;e.t=t||"d",h.ct=e}return h}htmlDecode(e){return e.replace(/&#(x)?([^&]{1,5});/g,function(e,t,l){return String.fromCharCode(parseInt(l,t?16:10))})}getCellImage(e,t){const l=this.extractImageId(t);let n={};return this.cellImages.forEach(e=>{const t=e.getInnerElements("xdr:pic")[0],r=t.getInnerElements("xdr:nvPicPr")[0].getInnerElements("xdr:cNvPr")[0],i=t.getInnerElements("xdr:blipFill")[0].getInnerElements("a:blip")[0],a=r.get("name"),s=i.get("r:embed");if(l==a){const e=this.getBase64ByRid(s,"xl/_rels/cellimages.xml.rels");n=e;let l=0,i=0,a=0,o=0;const c=t.getInnerElements("xdr:spPr")[0].getInnerElements("a:xfrm")[0],u=c.getInnerElements("a:off")[0],h=c.getInnerElements("a:ext")[0];a=getPxByEMUs(parseInt(h.get("cx"))),o=getPxByEMUs(parseInt(h.get("cy"))),l=getPxByEMUs(parseInt(u.get("x"))),i=getPxByEMUs(parseInt(u.get("y")));const g=a/this.cellSize.width,f=o/this.cellSize.height;g>1&&g>f&&(o/=g,a=this.cellSize.width),f>1&&f>g&&(a/=f,o=this.cellSize.height);let m={height:o,left:l,top:i,width:a};n.default=m,n.descr=r.get("descr")}}),n}extractImageId(e){const t=e.match(/ID_[A-Za-z0-9]{32}/);return t?t[0]:null}getBase64ByRid(e,t){let l=this.readXml.getElementsByTagName("Relationships/Relationship",t);if(null!=l&&l.length>0)for(let t=0;t<l.length;t++){let n=l[t].attributeList,r=getXmlAttibute(n,"Id",null),i=getXmlAttibute(n,"Target",null);if(r==e)return i=i.replace(/\.\.\//g,""),i="xl/"+i,this.imageList.getImageByName(i)}return{}}}var CFTextOperator,CFTimePeriodOperator,CFNumberOperator,CFRuleType,CFSubRuleType;!function(e){e.beginsWith="beginsWith",e.endsWith="endsWith",e.containsText="containsText",e.notContainsText="notContainsText",e.equal="equal",e.notEqual="notEqual",e.containsBlanks="containsBlanks",e.notContainsBlanks="notContainsBlanks",e.containsErrors="containsErrors",e.notContainsErrors="notContainsErrors"}(CFTextOperator||(CFTextOperator={})),function(e){e.today="today",e.yesterday="yesterday",e.tomorrow="tomorrow",e.last7Days="last7Days",e.thisMonth="thisMonth",e.lastMonth="lastMonth",e.nextMonth="nextMonth",e.thisWeek="thisWeek",e.lastWeek="lastWeek",e.nextWeek="nextWeek"}(CFTimePeriodOperator||(CFTimePeriodOperator={})),function(e){e.greaterThan="greaterThan",e.greaterThanOrEqual="greaterThanOrEqual",e.lessThan="lessThan",e.lessThanOrEqual="lessThanOrEqual",e.notBetween="notBetween",e.between="between",e.equal="equal",e.notEqual="notEqual"}(CFNumberOperator||(CFNumberOperator={})),function(e){e.highlightCell="highlightCell",e.dataBar="dataBar",e.colorScale="colorScale",e.iconSet="iconSet"}(CFRuleType||(CFRuleType={})),function(e){e.uniqueValues="uniqueValues",e.duplicateValues="duplicateValues",e.rank="rank",e.text="text",e.timePeriod="timePeriod",e.number="number",e.average="average",e.formula="formula"}(CFSubRuleType||(CFSubRuleType={}));class LuckyCondition{constructor(e,t,l){this.stopIfTrue=!1,this.handleRules=(e,t,l)=>{const{attributeList:n,value:r,extLst:i,isExtLst:a}=e,s=getXmlAttibute(n,"type","expression"),o={type:CFRuleType.highlightCell},c=getXmlAttibute(n,"operator",""),u=getXmlAttibute(n,"rank",""),h=t.getElementsByTagName("formula",r,!1);switch(getXmlAttibute(n,"aboveAverage",""),c&&(o.operator=c),(h[0]?.value||"0"==h[0]?.value)&&(o.value=str2num(h[0]?.value)),s){case"expression":o.subType=CFSubRuleType.formula;break;case"cellIs":o.subType=CFSubRuleType.number;break;case"top10":o.subType=CFSubRuleType.rank;const e=getXmlAttibute(n,"percent","0"),s=getXmlAttibute(n,"bottom","0");u&&(o.value=str2num(u)),o.isBottom="1"===s,o.isPercent="1"===e;break;case"aboveAverage":o.subType=CFSubRuleType.average,o.operator=o.operator||CFNumberOperator.lessThan;break;case"timePeriod":o.subType=CFSubRuleType.timePeriod,o.operator=getXmlAttibute(n,"timePeriod",void 0);break;case"duplicateValues":o.subType=CFSubRuleType.duplicateValues;break;case"containsText":o.subType=CFSubRuleType.text,o.operator="containsText",o.value=getXmlAttibute(n,"text","");break;case"colorScale":const c=t.getElementsByTagName("colorScale/cfvo",r,!1),h=t.getElementsByTagName("colorScale/color",r,!1);o.type=CFRuleType.colorScale,o.config=c.map((e,t)=>{const n=getXmlAttibute(e.attributeList,"type",""),r=getXmlAttibute(e.attributeList,"val",void 0);return{index:0,color:h[t]?getColor(h[t],l):void 0,value:{type:n,value:str2num(r)}}});break;case"dataBar":o.type=CFRuleType.dataBar;const g=t.getElementsByTagName("dataBar",r,!1)?.[0],f=t.getElementsByTagName("cfvo",g.value,!1),m=t.getElementsByTagName("color",g.value,!1),d=getXmlAttibute(g.attributeList,"showValue","1");o.isShowValue="1"===d;let p=m[0]?getColor(m[0],l):void 0,E=!0,y="";if(i){const e=getXmlAttibute(t.getElementsByTagName("x14:dataBar",i.value,!1)[0].attributeList,"gradient",null),n=t.getElementsByTagName("x14:dataBar/x14:negativeFillColor",i.value,!1)?.[0];y=n?getColor(n,l):void 0,E="0"!==e}o.config={min:{type:getXmlAttibute(f[0]?.attributeList,"type","min"),value:str2num(getXmlAttibute(f[0]?.attributeList,"val",void 0))},max:{type:getXmlAttibute(f[1]?.attributeList,"type","max"),value:str2num(getXmlAttibute(f[1]?.attributeList,"val",void 0))},isGradient:E,positiveColor:p,nativeColor:y};break;case"iconSet":if(o.type=CFRuleType.iconSet,a){const e=t.getElementsByTagName("x14:iconSet",r,!1)[0],l=t.getElementsByTagName("x14:iconSet/x14:cfvo",r,!1),n=t.getElementsByTagName("x14:iconSet/x14:cfIcon",r,!1),i="1"===getXmlAttibute(e?.attributeList,"custom","0");o.isShowValue="0"!==e?.attributeList?.showValue,o.config=l.map((l,r)=>{const a=t.getElementsByTagName("xm:f",l.value,!1)[0];let s=n[r]?.attributeList;const o=i?s?.iconSet:e?.attributeList.iconSet,c=str2num(o.charAt(0))-str2num(s?.iconId)-1;return{operator:CFNumberOperator.greaterThanOrEqual,value:{type:l.attributeList.type,value:str2num(a?.value)},iconType:o,iconId:c}}).reverse()}else{const e=t.getElementsByTagName("iconSet",r,!1),l=t.getElementsByTagName("iconSet/cfvo",r,!1);o.isShowValue="0"!==e[0]?.attributeList?.showValue,o.config=l.map((t,l)=>({operator:o.operator||CFNumberOperator.greaterThanOrEqual,value:{type:t.attributeList.type,value:str2num(t.attributeList.val)},iconType:e[0].attributeList.iconSet,iconId:l}))}}const g=getXmlAttibute(n,"dxfId",null);if(g){let e=l.dxfs;const t=null!==g?e[Number(g)]:void 0,n=t.getInnerElements("font")?.[0],r=t.getInnerElements("numFmt")?.[0],i=t.getInnerElements("fill")?.[0],a=t.getInnerElements("border")?.[0];let s=l.numfmts,c={};if(a){const{borderCellValue:e}=handleBorder(a,l);c.border=e}if(i){const e=getBackgroundByFill(i,l);c.bg=e}if(r){let e=s[parseInt(r?.attributeList?.numFmtId)],t=new LuckySheetCellFormat;t.fa=e?escapeCharacter(e):r.attributeList.formatCode,c.ct=t}if(n){const{cellValue:e}=getFontStyle(n,c);c={...c,...e}}o.style=c}this.rule=o};const{attributeList:n,parentAttribute:r}=e;r?.sqref&&(this.ranges=handleRanges(r.sqref)),this.order=Number(getXmlAttibute(n,"priority","1")),this.cfId=generateRandomIndex("condition"),this.stopIfTrue="1"===getXmlAttibute(n,"stopIfTrue","0"),this.handleRules(e,t,l)}}class LuckyVerification{constructor(e,t){let l=e.attributeList,n=e.value,r=getXmlAttibute(l,"type",void 0);if(!r)return;this.uid=generateRandomIndex("verification");let i=[],a="";const s=getXmlAttibute(l,"operator",void 0),o="1"===getXmlAttibute(l,"allowBlank",void 0),c="1"===getXmlAttibute(l,"showInputMessage",void 0),u="1"===getXmlAttibute(l,"showErrorMessage",void 0),h=getXmlAttibute(l,"prompt",void 0),g=getXmlAttibute(l,"promptTitle",void 0),f=getXmlAttibute(l,"error",void 0),m=getXmlAttibute(l,"errorTitle",void 0),d=getXmlAttibute(l,"errorStyle","stop");if(new RegExp(/<x14:formula1>|<xm:sqref>/g).test(n)&&t?.length>=0){const e=getPeelOffX14(n);a=e?.sqref,i=getMultiFormulaValue(e?.formula)}else i=getMultiFormulaValue(n),a=getXmlAttibute(l,"sqref",null);let p=i?.length>=1?i[0]:void 0,E=2===i?.length?i[1]:void 0;switch(a&&(this.ranges=handleRanges(a)),this.type=r,this.allowBlank=o,this.operator=s,this.formula1=p,this.formula2=E,this.showErrorMessage=u,this.showInputMessage=c,this.prompt=h,this.promptTitle=g,this.error=f,this.errorTitle=m,d){case"information":this.errorStyle=0;break;case"warning":this.errorStyle=2;break;case"stop":this.errorStyle=1}this.ranges=handleRanges(a)}}class LuckFilter{constructor(e,t){const l=e.getElementsByTagName("autoFilter",t)[0];if(!l)return;this.ref=handleRanges(l.attributeList.ref)?.[0];const n=l.getInnerElements("filterColumn");this.filterColumns=n?.map(e=>{const t=e.getInnerElements("customFilters")?.[0],l=e.getInnerElements("filters")?.[0];let n,r,i=str2num(e.attributeList.colId);if(i=this.ref?i+this.ref.startRow:i,t){const e=t.getInnerElements("customFilter");n={and:"1"===t.attributeList?.and?1:void 0,customFilters:e.map(e=>({val:replaceSpecialWrap(e.attributeList.val),operator:e.attributeList?.operator}))}}if(l){const e=l.getInnerElements("filter");r={blank:"1"===l.attributeList?.blank,filters:e.map(e=>replaceSpecialWrap(e.attributeList.val))}}return{colId:i,filters:r,customFilters:n}})}}class LuckyFreezen{constructor(e){const t=getXmlAttibute(e.attributeList,"xSplit","0"),l=getXmlAttibute(e.attributeList,"ySplit","0");this.horizen=Number(l),this.vertical=Number(t)}}const getChartType=(e,t)=>{const l=e.getElementsByTagName("c:barChart",t)[0],n=e.getElementsByTagName("c:lineChart",t)[0],r=e.getElementsByTagName("c:pieChart",t)[0],i=e.getElementsByTagName("c:doughnutChart",t)[0],a=e.getElementsByTagName("c:areaChart",t)[0],s=e.getElementsByTagName("c:radarChart",t)[0],o=e.getElementsByTagName("c:scatterChart",t)[0];let c=[],u=l,h=ChartTypeBits.Column;if(l){const e=l.getInnerElements("c:barDir")?.[0]?.get("val"),t=l.getInnerElements("c:grouping")?.[0]?.get("val");"col"===e?(h=ChartTypeBits.Column,"stacked"===t?h=ChartTypeBits.ColumnStacked:"percentStacked"===t&&(h=ChartTypeBits.ColumnPercentStacked)):"bar"===e&&(h=ChartTypeBits.Bar,"stacked"===t?h=ChartTypeBits.BarStacked:"percentStacked"===t&&(h=ChartTypeBits.BarPercentStacked)),u=l,c.push({chartEle:u,chartType:h})}if(n&&(u=n,h=ChartTypeBits.Line,c.push({chartEle:u,chartType:h})),r&&(u=r,h=ChartTypeBits.Pie,c.push({chartEle:u,chartType:h})),i&&(u=i,h=ChartTypeBits.Doughnut,c.push({chartEle:u,chartType:h})),a){u=a,h=ChartTypeBits.Area;const e=a.getInnerElements("c:grouping")?.[0]?.get("val");"stacked"===e?h=ChartTypeBits.AreaStacked:"percentStacked"===e&&(h=ChartTypeBits.AreaPercentStacked),c.push({chartEle:u,chartType:h})}return s&&(u=s,h=ChartTypeBits.Radar,c.push({chartEle:u,chartType:h})),o&&(u=o,h=ChartTypeBits.Scatter,c.push({chartEle:u,chartType:h})),c.length>1&&(h=ChartTypeBits.Combination,u=c),{chartEle:u,chartType:h}};class LuckyChartImage extends LuckyChartImageBase{constructor(e,t,l,n){super(),this.id=e,this.type="chart",this.data={chartType:n,range:l,border:"#979DAC",background:"rgba(0,0,0,0)",isRowDirection:!0};let r=0,i=0,a=0,s=0;const o=t.getInnerElements("a:off")[0],c=t.getInnerElements("a:ext")[0];a=getPxByEMUs(parseInt(c.get("cx"))),s=getPxByEMUs(parseInt(c.get("cy"))),r=getPxByEMUs(parseInt(o.get("x"))),i=getPxByEMUs(parseInt(o.get("y"))),this.transform={width:a,height:s,top:i,left:r}}}class ChartImageGroup{constructor({graphicFrame:e,readXml:t,drawingRelsFile:l,styles:n}){this.getChartRange=e=>{let t=0,l=0,n=0,r=0;if(Array.isArray(e))e.map(e=>this.getChartRef(e.chartEle.value)).forEach((e,i)=>{0===i?(t=e.maxColumn,l=e.maxRow,n=e.minColumn,r=e.minRow):(t=Math.max(t,e.maxColumn),l=Math.max(l,e.maxRow),n=Math.min(n,e.minColumn),r=Math.min(r,e.minRow))});else{const i=this.getChartRef(e.value);t=i.maxColumn,l=i.maxRow,n=i.minColumn,r=i.minRow}const i=numberToABC(t)+(l+1);return numberToABC(n)+(r+1)+":"+i},this.getChartRef=e=>{const t=this.readXml.getElementsByTagName("c:ser/c:cat/c:numRef/c:f",e,!1)?.[0],l=this.readXml.getElementsByTagName("c:ser/c:cat/c:strRef/c:f",e,!1)?.[0],n=this.readXml.getElementsByTagName("c:ser/c:xVal/c:strRef/c:f",e,!1)?.[0],r=this.readXml.getElementsByTagName("c:ser/c:xVal/c:numRef/c:f",e,!1)?.[0],i=t||l||n||r,a=this.readXml.getElementsByTagName("c:ser/c:tx/c:strRef/c:f",e,!1),s=i,o=a[a.length-1],c=getcellrange(s.value),u=getcellrange(o.value),h=[...c.column,...u.column],g=[...c.row,...u.row];return{maxColumn:Math.max(...h),maxRow:Math.max(...g),minColumn:Math.min(...h),minRow:Math.min(...g)}},this.readXml=t;const r=e.getInnerElements("xdr:xfrm")[0],i=function(e){const{rid:t,fileName:l,callback:n,readXml:r}=e;let i=r.getElementsByTagName("Relationships/Relationship",l);if(null!=i&&i.length>0)for(let e=0;e<i.length;e++){let l=i[e].attributeList,r=getXmlAttibute(l,"Id",null),a=getXmlAttibute(l,"Target",null);if(r==t)return a=a.replace(/\.\.\//g,""),n?n(a):a}return null}({rid:t.getElementsByTagName("a:graphic/a:graphicData/c:chart",e.value,!1)[0].get("r:id"),fileName:l,readXml:t}),{chartEle:a,chartType:s}=getChartType(t,i),o=this.getChartRange(a),c=generateRandomId();this.image=new LuckyChartImage(c,r,o,s);const u=new Chart({id:c,range:o,chartType:s,chartFile:i,readXml:t,image:this.image,styles:n});this.chart=u.model}}class Chart extends LuckyChart{constructor(e){super(),this.getStyle=e=>{const t=this.readXml.getElementsByTagNameLink("c:spPr",this.chartFile)[0],l=t.getInnerElements("a:solidFill")[0],n=t.getInnerElements("a:ln")[0],r=l?this.getColor(l.getInnerElements("a:schemeClr")[0]):void 0,i=n?this.getColor(n.getInnerElements("a:schemeClr")[0]):void 0,a=this.getAllTitle(),s=this.readXml.getElementsByTagNameLink("c:chart/c:autoTitleDeleted",this.chartFile)[0],o=this.readXml.getElementsByTagNameLink("c:chart/c:plotArea",this.chartFile)[0],c=this.getAxis(o?.getInnerElements("c:catAx")?.[0]),u=this.getAxis(o?.getInnerElements("c:valAx")?.[0]),h=this.readXml.getElementsByTagNameLink("c:chart/c:legend",this.chartFile)[0],g=this.getLegend(h);return{titles:{...a,titlePosition:"1"===s?.get("val")?"hide":"top"},runtime:{},width:e.transform.width,height:e.transform.height,backgroundColor:r,borderColor:i,xAxis:c,yAxis:u,legend:g,...this.getChartSeries()}},this.getChartSeries=()=>{const{chartEle:e,chartType:t}=getChartType(this.readXml,this.chartFile);if(!e)return{};if(Array.isArray(e))return{seriesStyleMap:e.map(e=>this.getChartSeriesBase(e.chartEle,e.chartType,!0)).reduce((e,t)=>Object.assign(e,t),{})};const l=e.getInnerElementsTagLink("c:dLbls")[0].getInnerElements("c:showVal")[0];return{allSeriesStyle:{label:{visible:!!l&&"1"===l.get("val")}},seriesStyleMap:this.getChartSeriesBase(e,t)}},this.getChartSeriesBase=(e,t,l)=>{const n=e.getInnerElements("c:ser"),r={};return n.forEach(e=>{const n=e.getInnerElements("c:idx")[0],i=parseInt(n.get("val"))+1,a=e.getInnerElements("c:spPr")[0],s=a?.getInnerElementsTagLink("a:solidFill")?.[0],o=a?.getInnerElements("a:ln")?.[0],c=this.getColor(s?.getInnerElements("a:schemeClr")?.[0]),u=s?.getInnerElements("a:alpha")?.[0]?.get("val"),h=o?this.getLine(o):void 0,g=e.getInnerElements("c:dLbls")[0],f=g.getInnerElements("c:showVal")?.[0]?.get("val"),m=g.getInnerElements("c:showCatName")?.[0]?.get("val"),d=g.getInnerElements("c:showSerName")?.[0]?.get("val"),p=g.getInnerElements("c:showPercent")?.[0]?.get("val"),E=this.getBaseStyle(g.getInnerElements("a:defRPr")?.[0]),y=0|("1"===f?LabelContentType.Value:0)|("1"===m?LabelContentType.CategoryName:0)|("1"===d?LabelContentType.SeriesName:0)|("1"===p?LabelContentType.Percentage:0),b={border:h,label:{visible:!!y,contentType:y,...E},color:c,fillOpacity:u?parseInt(u)/1e5:1,chartType:l?t:void 0};let T=this.getExtraSerise(b,e,t);r[i]=T}),r},this.getExtraSerise=(e,t,l)=>{if(l===ChartTypeBits.Line){e.border?.color&&(e.color=e.border.color);const l=t.getInnerElements("c:marker")[0],n=l.getInnerElements("c:symbol")?.[0]?.get("val"),r=l.getInnerElements("c:size")?.[0]?.get("val"),i=l.getInnerElementsTagLink("c:spPr/a:solidFill/a:schemeClr")?.[0],a=this.getColor(i);e.point={color:a,size:r?parseInt(r):void 0,shape:"none"===n&&e.label.visible?"circle":n}}return e},this.getLegend=e=>{if(!e)return{position:"hide"};const t=e.getInnerElements("c:legendPos")[0]?.get("val"),l=e.getInnerElements("c:txPr")[0].getInnerElements("a:pPr")[0],n=this.getBaseStyle(l.getInnerElements("a:defRPr")[0]);return{position:t?{t:"top",b:"bottom",l:"left",r:"right"}[t]:"bottom",label:n}},this.getAxis=e=>{if(!e)return;const t=!e.getInnerElementsTagLink("c:spPr/a:ln/a:noFill")?.length,l=e.getInnerElements("c:scaling")[0],n="maxMin"===l?.getInnerElements("c:orientation")[0]?.get("val"),r=l?.getInnerElements("c:max")?.[0]?.get("val"),i=l?.getInnerElements("c:min")?.[0]?.get("val"),a=e.getInnerElements("c:lblAlgn")?.[0]?.get("val"),s=e.getInnerElements("c:txPr")[0],o=s.getInnerElements("a:pPr")[0],c=s?.getInnerElements("a:bodyPr")?.[0]?.get("rot"),u=this.getBaseStyle(o.getInnerElements("a:defRPr")[0]),h=e.getInnerElements("c:majorGridlines")?.[0],g=h?.getInnerElements("a:ln")[0],f=g?.get("w")?getPxByEMUs(parseInt(g.get("w"))):void 0,m=e.getInnerElements("c:majorTickMark")?.[0],d=this.getColor(g?.getInnerElements("a:schemeClr")?.[0]);return{lineVisible:t,reverse:n,max:r?parseInt(r):void 0,min:i?parseInt(i):void 0,label:{axisTitleAlign:a?{l:"start",r:"end",ctr:"center"}[a]:"center",rotate:c&&parseInt(c)>0?parseInt(c)/6e4:0,...u},gridLine:{visible:!!h?.value,width:f,color:d},tick:{visible:"none"!==m?.get("val"),position:"out"===m?.get("val")?"outside":"inside",lineWidth:f}}},this.getLine=e=>{const t=e?.get("w")?getPxByEMUs(parseInt(e.get("w"))):0,l=this.getColor(e?.getInnerElements("a:schemeClr")?.[0]),n=e.getInnerElements("a:prstDash")?.[0]?.get("val"),r={solid:"solid",dot:"dotted",dash:"dashed",sysDot:"dotted",sysDash:"dashed",lgDash:"dashed"};return{dashType:n&&r[n]?r[n]:"solid",color:l,width:t}},this.getAllTitle=()=>{const e=this.readXml.getElementsByTagNameLink("c:chart/c:title",this.chartFile)[0],t=this.readXml.getElementsByTagNameLink("c:chart/c:plotArea/c:catAx/c:title",this.chartFile)[0],l=this.readXml.getElementsByTagNameLink("c:chart/c:plotArea/c:valAx/c:title",this.chartFile)[0];return{title:this.getTitle(e),xAxisTitle:this.getTitle(t),yAxisTitle:this.getTitle(l)}},this.getTitle=e=>{if(!e)return;const t=e.getInnerElements("a:r"),l=e.getInnerElements("a:pPr")[0],n=this.getBaseStyle(l.getInnerElements("a:defRPr")[0]),r=t?.map(e=>this.getBaseStyle(e.getInnerElements("a:rPr")?.[0]))||[];return{content:t?.map(e=>e.getInnerElements("a:t")[0].value).join(""),...n,...r.length?r[0]:{}}},this.getBaseStyle=e=>{if(!e)return{};const t=e.getInnerElements("a:schemeClr")?.[0],l=e.getInnerElements("a:solidFill")?.[0],n=!t&&l?this.getThemColor(l):this.getColor(t),r={};return e.get("sz")&&(r.fontSize=parseInt(e.get("sz"))/100),e.get("b")&&(r.bold="1"===e.get("b")),e.get("i")&&(r.italic="1"===e.get("i")),n&&(r.color=n),r},this.getColor=e=>{if(!e)return;const t=e.get("val"),l=this.styles.clrScheme.find(e=>{const l=e.getInnerElements("a:sysClr|a:srgbClr")[0];return!!e.container.includes(t)||("tx1"===t?"windowText"===l.get("val"):"bg1"===t&&"window"===l.get("val"))});let n="#000000";l&&(n=this.getThemColor(l));const r=e.getInnerElements("a:lumMod")?.[0]?.get("val"),i=e.getInnerElements("a:lumOff")?.[0]?.get("val");return`rgb(${hexToRgbArray(n).map(e=>{const t=r?e*parseInt(r)/1e5:e,l=i?Math.round(parseInt(i)/1e5*255):0;return Math.round(t+l)}).join(",")})`},this.getThemColor=e=>{let t="#000000";const l=e.getInnerElements("a:sysClr|a:srgbClr");if(null!=l){const e=l[0],n=e.attributeList;e.container.indexOf("sysClr")>-1?null!=n.lastClr?t="#"+n.lastClr:null!=n.val&&(t="#"+n.val):e.container.indexOf("srgbClr")>-1&&(t="#"+n.val)}return t},this.getContext=()=>({categoryIndex:0,seriesIndexes:this.readXml.getElementsByTagName("c:ser",this.chartFile).map(e=>{const t=e.getInnerElements("c:idx")[0];return parseInt(t.get("val"))+1})});const{id:t,range:l,chartType:n,chartFile:r,readXml:i,image:a,styles:s}=e;this.styles=s,this.range=l,this.chartType=n,this.readXml=i,this.chartFile=r,this.isRowDirection=!0,this.id=t,this.context=this.getContext(),this.style=this.getStyle(a)}get model(){return{id:this.id,range:this.range,chartType:this.chartType,context:this.context,style:this.style,isRowDirection:this.isRowDirection}}}class LuckySheet extends LuckySheetBase{constructor(e,t,l,n=!1,r){super(),this.getImageBaseInfo=(e,t)=>{let l=this.readXml.getElementsByTagName("xdr:twoCellAnchor",e),n=this.readXml.getElementsByTagName("xdr:oneCellAnchor",e);if(l=[...l,...n],null!=l&&l.length>0)for(let e=0;e<l.length;e++){let n=l[e],r=n.getInnerElements("xdr:from"),i=n.getInnerElements("xdr:to");if(null!=r&&r.length>0){let e,l,a=r[0];i?e=i[0]:l=n.getInnerElements("xdr:ext")[0];let s={};n.getInnerElements("xdr:graphicFrame")&&(s=this.getGraphic(n,t)),n.getInnerElements("xdr:pic")&&(s=this.getImage(n,t));let o=0,c=0,u=0,h=0;if(s.fromCol=this.getXdrValue(a.getInnerElements("xdr:col")),s.fromColOff=getPxByEMUs(this.getXdrValue(a.getInnerElements("xdr:colOff"))),s.fromRow=this.getXdrValue(a.getInnerElements("xdr:row")),s.fromRowOff=getPxByEMUs(this.getXdrValue(a.getInnerElements("xdr:rowOff"))),e)s.toCol=this.getXdrValue(e.getInnerElements("xdr:col")),s.toColOff=getPxByEMUs(this.getXdrValue(e.getInnerElements("xdr:colOff"))),s.toRow=this.getXdrValue(e.getInnerElements("xdr:row")),s.toRowOff=getPxByEMUs(this.getXdrValue(e.getInnerElements("xdr:rowOff")));else{let e=l.attributeList;u=getPxByEMUs(parseInt(e.cx)),h=getPxByEMUs(parseInt(e.cy)),s.toCol=s.fromCol,s.toColOff=Number(s.fromColOff)+u,s.toRow=s.fromRow,s.toRowOff=Number(s.fromRowOff)+h}s.originWidth=u,s.originHeight=h,s.isFixedPos=!1,s.fixedLeft=0,s.fixedTop=0;let g={color:"#000",radius:0,style:"solid",width:0};s.border=g;let f={height:h,offsetLeft:0,offsetTop:0,width:u};s.crop=f;let m={height:h,left:o,top:c,width:u};s.default=m,null==this.images&&(this.images={}),s.id&&(this.images[s.id||generateRandomIndex("image")]=s)}}return null},this.getImage=(e,t)=>{let l=e.getInnerElements("a:blip"),n=getXmlAttibute(e.attributeList,"editAs","twoCell");if(null!=l&&l.length>0){let e=getXmlAttibute(l[0].attributeList,"r:embed",null),r=this.getBase64ByRid(e,t);return r.type="absolute"==n?"3":"oneCell"==n?"2":"1",r}return{}},this.getGraphic=(e,t)=>{const l=e.getInnerElements("xdr:graphicFrame");if(l.length){const e=l[0],n=new ChartImageGroup({graphicFrame:e,readXml:this.readXml,drawingRelsFile:t,styles:this.styles}),r=n.image;return n.chart&&(null==this.charts&&(this.charts=[]),this.charts.push(n.chart)),r}return{}},this.getCellSize=e=>{let t=e.attributeList,l=t.r;t.s,t.t;let n=getcellrange(l);const r=n.row[0],i=n.column[0];return{width:this.config.columnlen&&this.config.columnlen[i]?this.config.columnlen[i]:this.defaultColWidth,height:this.config.rowlen&&this.config.rowlen[r]?this.config.rowlen[r]:this.defaultRowHeight}},this.isInitialCell=n,this.readXml=r.readXml,this.sheetFile=r.sheetFile,this.styles=r.styles,this.sharedStrings=r.sharedStrings,this.calcChainEles=r.calcChain,this.sheetList=r.sheetList,this.imageList=r.imageList,this.hide=r.hide,this.cellImages=r.cellImages,this.name=e,this.index=t,this.order=l.toString(),this.config=new LuckyConfig,this.celldata=[],this.mergeCells=this.readXml.getElementsByTagName("mergeCells/mergeCell",this.sheetFile),this.styles.clrScheme;let i=this.readXml.getElementsByTagName("sheetViews/sheetView",this.sheetFile),a="1",s="0",o="100",c="A1";if(i.length>0){let e=i[0].attributeList;a=getXmlAttibute(e,"showGridLines","1"),s=getXmlAttibute(e,"tabSelected","0"),o=getXmlAttibute(e,"zoomScale","100");let t=i[0].getInnerElements("selection");if(null!=t&&t.length>0){c=getXmlAttibute(t[0].attributeList,"activeCell","A1");let e=getcellrange(c);this.luckysheet_select_save=[],this.luckysheet_select_save.push(e)}let l=i[0].getInnerElements("pane");l?.length>0&&(this.freezen=new LuckyFreezen(l[0]))}this.showGridLines=a,this.status=s,this.zoomRatio=parseInt(o)/100;let u=this.readXml.getElementsByTagName("sheetPr/tabColor",this.sheetFile);if(null!=u&&u.length>0){let e=u[0];e.attributeList;let t=getColor(e,this.styles,"b");this.color=t}let h,g,f=this.readXml.getElementsByTagName("sheetFormatPr",this.sheetFile);if(f.length>0){let e=f[0].attributeList;h=getXmlAttibute(e,"defaultColWidth","9.21"),g=getXmlAttibute(e,"defaultRowHeight","19")}this.defaultColWidth=getColumnWidthPixel(parseFloat(h)),this.defaultRowHeight=getRowHeightPixel(parseFloat(g)),this.generateConfigColumnLenAndHidden();let m=this.generateConfigRowLenAndHiddenAddCell();null==this.calcChain&&(this.calcChain=[]);let d={};for(let e=0;e<this.calcChainEles.length;e++){let l=this.calcChainEles[e].attributeList;if(l.i!=t)continue;let n=l.r;l.i,l.l,l.s,l.a,l.t;let r=getcellrange(n),i=new LuckysheetCalcChain;i.r=r.row[0],i.c=r.column[0],i.index=this.index,this.calcChain.push(i),d["r"+n+"c"+e]=null}if(null!=this.formulaRefList)for(let e in this.formulaRefList){let t=this.formulaRefList[e],l=t.mainRef,n=l.cellValue,r=l.fv,i=n.r,a=n.c;for(let e in t){if("mainRef"==e)continue;let l=t[e].cellValue;if(null==l)continue;let n=r,s=l.r-i,o=l.c-a;s>0?n="="+fromulaRef.functionCopy(n,"down",s):s<0&&(n="="+fromulaRef.functionCopy(n,"up",Math.abs(s))),o>0?n="="+fromulaRef.functionCopy(n,"right",o):o<0&&(n="="+fromulaRef.functionCopy(n,"left",Math.abs(o))),l.v.f=n;let c=new LuckysheetCalcChain;c.r=l.r,c.c=l.c,c.index=this.index,this.calcChain.push(c)}}for(let e in m.formulaList)if(!(e in d)){let t=m.formulaList[e],l=new LuckysheetCalcChain;l.r=t.r,l.c=t.c,l.index=this.index,this.calcChain.push(l)}const p=this.readXml.getElementsByTagName("conditionalFormatting",this.sheetFile),E=this.readXml.getElementsByTagName("extLst/ext/x14:conditionalFormattings/x14:conditionalFormatting",this.sheetFile)||[],y=E?.map(e=>{const t=this.readXml.getElementsByTagName("xm:sqref",e.value,!1)?.[0];return this.readXml.getElementsByTagName("x14:cfRule",e.value,!1).map(e=>({...e,parentAttribute:{sqref:t?.value},isExtLst:!0,extLst:void 0}))})?.flat()||[];if(p?.length){const e=p.map(e=>this.readXml.getElementsByTagName("cfRule",e.value,!1)?.map(t=>({...t,parentAttribute:e.attributeList,extLst:y.find(t=>t.parentAttribute.sqref===e.attributeList?.sqref)})))?.flat().filter(Boolean).concat(y?.filter(e=>-1===p.findIndex(t=>t.attributeList.sqref===e.parentAttribute.sqref)))||[];this.conditionalFormatting=e.map(e=>new LuckyCondition(e,this.readXml,this.styles))}const b=new LuckFilter(this.readXml,this.sheetFile);if(b.ref&&(this.filter=b),this.dataVerification=this.generateConfigDataValidations(),this.dataVerificationList=this.generateConfigDataValidationsList(),this.hyperlink=this.generateConfigHyperlinks(),this.hide=this.hide,null!=this.mergeCells)for(let e=0;e<this.mergeCells.length;e++){let t=this.mergeCells[e].attributeList.ref;if(null==t)continue;let l=getcellrange(t),n=new LuckySheetConfigMerge;n.r=l.row[0],n.c=l.column[0],n.rs=l.row[1]-l.row[0]+1,n.cs=l.column[1]-l.column[0]+1,null==this.config.merge&&(this.config.merge={}),this.config.merge[l.row[0]+"_"+l.column[0]]=n}let T=r.drawingFile,C=r.drawingRelsFile;null!=T&&null!=C&&this.getImageBaseInfo(T,C)}getXdrValue(e){return null==e||0==e.length?null:parseInt(e[0].value)}getBase64ByRid(e,t){let l=this.readXml.getElementsByTagName("Relationships/Relationship",t);if(null!=l&&l.length>0)for(let t=0;t<l.length;t++){let n=l[t].attributeList,r=getXmlAttibute(n,"Id",null),i=getXmlAttibute(n,"Target",null);if(r==e)return i=i.replace(/\.\.\//g,""),i="xl/"+i,this.imageList.getImageByName(i)}return{}}generateConfigColumnLenAndHidden(){let e=this.readXml.getElementsByTagName("cols/col",this.sheetFile);for(let t=0;t<e.length;t++){let l=e[t].attributeList,n=getXmlAttibute(l,"min",null),r=getXmlAttibute(l,"max",null),i=getXmlAttibute(l,"width",null),a=getXmlAttibute(l,"hidden",null),s=getXmlAttibute(l,"customWidth",null);if(null==n||null==r)continue;let o=parseInt(n)-1,c=parseInt(r)-1,u=parseFloat(i);for(let e=o;e<=c;e++)null!=i&&(null==this.config.columnlen&&(this.config.columnlen={}),this.config.columnlen[e]=getColumnWidthPixel(u)),"1"==a&&(null==this.config.colhidden&&(this.config.colhidden={}),this.config.colhidden[e]=0),null!=s&&(null==this.config.customWidth&&(this.config.customWidth={}),this.config.customWidth[e]=1)}}generateConfigRowLenAndHiddenAddCell(){let e=this.readXml.getElementsByTagName("sheetData/row",this.sheetFile),t={formulaList:{}};for(let l=0;l<e.length;l++){let n=e[l],r=n.attributeList,i=getXmlAttibute(r,"r",null),a=getXmlAttibute(r,"ht",null),s=getXmlAttibute(r,"hidden",null),o=getXmlAttibute(r,"customHeight",null);if(null==i)continue;let c=parseInt(i)-1;if(null!=a){let e=parseFloat(a);null==this.config.rowlen&&(this.config.rowlen={}),this.config.rowlen[c]=getRowHeightPixel(e)}if("1"==s&&(null==this.config.rowhidden&&(this.config.rowhidden={}),this.config.rowhidden[c]=0),null!=o&&(null==this.config.customHeight&&(this.config.customHeight={}),this.config.customHeight[c]=1),this.isInitialCell){let e=n.getInnerElements("c");for(let l in e){let n=e[l];const r=this.getCellSize(n);let i=new LuckySheetCelldata(n,r,this.styles,this.sharedStrings,this.mergeCells,this.sheetFile,this.cellImages,this.imageList,this.readXml);if(null!=i._borderObject&&(null==this.config.borderInfo&&(this.config.borderInfo=[]),this.config.borderInfo.push(i._borderObject),delete i._borderObject),"shared"==i._formulaType){let e;null==this.formulaRefList&&(this.formulaRefList={}),null==this.formulaRefList[i._formulaSi]&&(this.formulaRefList[i._formulaSi]={}),null!=i.v&&(e=i.v.f);let t={t:i._formulaType,ref:i._fomulaRef,si:i._formulaSi,fv:e,cellValue:i};null!=i._fomulaRef?this.formulaRefList[i._formulaSi].mainRef=t:this.formulaRefList[i._formulaSi][i.r+"_"+i.c]=t}if(null!=i.v&&null!=i.v.f){let e={r:i.r,c:i.c};t.formulaList["r"+i.r+"c"+i.c]=e}this.celldata.push(i)}}}return t}generateConfigDataValidationsList(){let e=this.readXml.getElementsByTagName("dataValidations/dataValidation",this.sheetFile),t=this.readXml.getElementsByTagName("extLst/ext/x14:dataValidations/x14:dataValidation",this.sheetFile)||[];return e=e.concat(t),e.map(e=>new LuckyVerification(e,t)).filter(e=>e.uid)}generateConfigDataValidations(){let e=this.readXml.getElementsByTagName("dataValidations/dataValidation",this.sheetFile),t=this.readXml.getElementsByTagName("extLst/ext/x14:dataValidations/x14:dataValidation",this.sheetFile)||[];e=e.concat(t);let l={};for(let n=0;n<e.length;n++){let r=e[n],i=r.attributeList,a=r.value,s=getXmlAttibute(i,"type",null);if(!s)continue;let o="",c="",u=[],h=[],g="1"===getXmlAttibute(i,"allowBlank",null);if(new RegExp(/<x14:formula1>|<xm:sqref>/g).test(a)&&t?.length>=0){o=getXmlAttibute(i,"operator",null);const e=getPeelOffX14(a);c=e?.sqref,u=getMultiSequenceToNum(c),h=getMultiFormulaValue(e?.formula)}else o=getXmlAttibute(i,"operator",null),c=getXmlAttibute(i,"sqref",null),u=getMultiSequenceToNum(c),h=getMultiFormulaValue(a);let f=DATA_VERIFICATION_MAP[s],m=null,d=h?.length>=1?h[0]:"",p=2===h?.length?h[1]:"",E=getXmlAttibute(i,"prompt",null),y=!!E;const b=COMMON_TYPE2.includes(f)||!DATA_VERIFICATION_TYPE2_MAP[f]?"common":f;if(m=o?DATA_VERIFICATION_TYPE2_MAP[b][o]:"bw","text_content"===f&&(d?.includes("LEN")||d?.includes("len"))&&d?.includes("=11")&&(f="validity",m="phone"),"date"===f){const e=new Date(1899,11,30,0,0,0);d=dayjs__default.default(e).clone().add(Number(d),"day").format("YYYY-MM-DD"),p=dayjs__default.default(e).clone().add(Number(p),"day").format("YYYY-MM-DD")}"checkbox"!==f&&"dropdown"!==f||(m=null);for(const e of u)l[e]={type:f,type2:m,value1:d,value2:p,checked:!1,remote:!1,prohibitInput:g,hintShow:y,hintText:E}}return l}generateConfigHyperlinks(){let e=this.readXml.getElementsByTagName("hyperlinks/hyperlink",this.sheetFile),t={};for(let l=0;l<e.length;l++){let n=e[l].attributeList,r=getMultiSequenceToNum(getXmlAttibute(n,"ref",null)),i=getXmlAttibute(n,"display",null),a=getXmlAttibute(n,"location",null),s=getXmlAttibute(n,"tooltip",null),o=a?"internal":"external";if(!a){let e=n["r:id"],t=this.sheetFile,l=this.readXml.getElementsByTagName("Relationships/Relationship",`xl/worksheets/_rels/${t.replace("xl/worksheets/","")}.rels`);const r=l?.find(t=>t.attributeList.Id===e);r&&(a=r.attributeList.Target,o=r.attributeList.TargetMode?.toLocaleLowerCase())}new RegExp(/^.*!R([\d$])+C([\d$])*$/g).test(a)&&(a=getTransR1C1ToSequence(a));for(const e of r)t[e]={linkAddress:a,linkTooltip:s||"",linkType:o,display:i||""}}return t}}let UDOC={};UDOC.G={concat:function(e,t){for(var l=0;l<t.cmds.length;l++)e.cmds.push(t.cmds[l]);for(l=0;l<t.crds.length;l++)e.crds.push(t.crds[l])},getBB:function(e){for(var t=1e99,l=1e99,n=-t,r=-l,i=0;i<e.length;i+=2){var a=e[i],s=e[i+1];a<t?t=a:a>n&&(n=a),s<l?l=s:s>r&&(r=s)}return[t,l,n,r]},rectToPath:function(e){return{cmds:["M","L","L","L","Z"],crds:[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]]}},insideBox:function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&e[2]<=t[2]&&e[3]<=t[3]},isBox:function(e,t){var l=function(e,t){for(var l=0;l<8;l+=2){for(var n=!0,r=0;r<8;r++)if(Math.abs(t[r]-e[r+l&7])>=2){n=!1;break}if(n)return!0}return!1};if(e.cmds.length>10)return!1;var n=e.cmds.join(""),r=e.crds,i=!1;if("MLLLZ"==n&&8==r.length||"MLLLLZ"==n&&10==r.length){10==r.length&&(r=r.slice(0,8));var a=t[0],s=t[1],o=t[2],c=t[3];i||(i=l(r,[a,s,o,s,o,c,a,c])),i||(i=l(r,[a,c,o,c,o,s,a,s]))}return i},boxArea:function(e){return(e[2]-e[0])*(e[3]-e[1])},newPath:function(e){e.pth={cmds:[],crds:[]}},moveTo:function(e,t,l){var n=UDOC.M.multPoint(e.ctm,[t,l]);e.pth.cmds.push("M"),e.pth.crds.push(n[0],n[1]),e.cpos=n},lineTo:function(e,t,l){var n=UDOC.M.multPoint(e.ctm,[t,l]);e.cpos[0]==n[0]&&e.cpos[1]==n[1]||(e.pth.cmds.push("L"),e.pth.crds.push(n[0],n[1]),e.cpos=n)},curveTo:function(e,t,l,n,r,i,a){var s;t=(s=UDOC.M.multPoint(e.ctm,[t,l]))[0],l=s[1],n=(s=UDOC.M.multPoint(e.ctm,[n,r]))[0],r=s[1],i=(s=UDOC.M.multPoint(e.ctm,[i,a]))[0],a=s[1],e.cpos=s,e.pth.cmds.push("C"),e.pth.crds.push(t,l,n,r,i,a)},closePath:function(e){e.pth.cmds.push("Z")},arc:function(e,t,l,n,r,i,a){if(a)for(;i>r;)i-=2*Math.PI;else for(;i<r;)i+=2*Math.PI;var s=(i-r)/4,o=Math.cos(s/2),c=-Math.sin(s/2),u=(4-o)/3,h=0==c?c:(1-o)*(3-o)/(3*c),g=u,f=-h,m=o,d=-c,p=[u,h],E=[g,f],y=[m,d],b={cmds:[0==e.pth.cmds.length?"M":"L","C","C","C","C"],crds:[o,c,u,h,g,f,m,d]},T=[1,0,0,1,0,0];UDOC.M.rotate(T,-s);for(var C=0;C<3;C++)p=UDOC.M.multPoint(T,p),E=UDOC.M.multPoint(T,E),y=UDOC.M.multPoint(T,y),b.crds.push(p[0],p[1],E[0],E[1],y[0],y[1]);var I=[n,0,0,n,t,l];UDOC.M.rotate(T,s/2-r),UDOC.M.concat(T,I),UDOC.M.multArray(T,b.crds),UDOC.M.multArray(e.ctm,b.crds),UDOC.G.concat(e.pth,b),l=b.crds.pop(),t=b.crds.pop(),e.cpos=[t,l]},toPoly:function(e){if("M"!=e.cmds[0]||"Z"!=e.cmds[e.cmds.length-1])return null;for(var t=1;t<e.cmds.length-1;t++)if("L"!=e.cmds[t])return null;var l=[],n=e.crds.length;for(e.crds[0]==e.crds[n-2]&&e.crds[1]==e.crds[n-1]&&(n-=2),t=0;t<n;t+=2)l.push([e.crds[t],e.crds[t+1]]);return UDOC.G.polyArea(e.crds)<0&&l.reverse(),l},fromPoly:function(e){for(var t={cmds:[],crds:[]},l=0;l<e.length;l++)t.crds.push(e[l][0],e[l][1]),t.cmds.push(0==l?"M":"L");return t.cmds.push("Z"),t},polyArea:function(e){if(e.length<6)return 0;for(var t=e.length-2,l=(e[0]-e[t])*(e[t+1]+e[1]),n=0;n<t;n+=2)l+=(e[n+2]-e[n])*(e[n+1]+e[n+3]);return.5*-l},polyClip:function(e,t){var l,n,r=function(e){return(s[0]-l[0])*(e[1]-l[1])>(s[1]-l[1])*(e[0]-l[0])},i=function(){var e=[l[0]-s[0],l[1]-s[1]],t=[n[0]-c[0],n[1]-c[1]],r=l[0]*s[1]-l[1]*s[0],i=n[0]*c[1]-n[1]*c[0],a=1/(e[0]*t[1]-e[1]*t[0]);return[(r*t[0]-i*e[0])*a,(r*t[1]-i*e[1])*a]},a=e;l=t[t.length-1];for(let e in t){var s=t[e],o=a;a=[],n=o[o.length-1];for(let e in o){var c;r(c=o[e])?(r(n)||a.push(i()),a.push(c)):r(n)&&a.push(i()),n=c}l=s}return a}},UDOC.M={getScale:function(e){return Math.sqrt(Math.abs(e[0]*e[3]-e[1]*e[2]))},translate:function(e,t,l){UDOC.M.concat(e,[1,0,0,1,t,l])},rotate:function(e,t){UDOC.M.concat(e,[Math.cos(t),-Math.sin(t),Math.sin(t),Math.cos(t),0,0])},scale:function(e,t,l){UDOC.M.concat(e,[t,0,0,l,0,0])},concat:function(e,t){var l=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5];e[0]=l*t[0]+n*t[2],e[1]=l*t[1]+n*t[3],e[2]=r*t[0]+i*t[2],e[3]=r*t[1]+i*t[3],e[4]=a*t[0]+s*t[2]+t[4],e[5]=a*t[1]+s*t[3]+t[5]},invert:function(e){var t=e[0],l=e[1],n=e[2],r=e[3],i=e[4],a=e[5],s=t*r-l*n;e[0]=r/s,e[1]=-l/s,e[2]=-n/s,e[3]=t/s,e[4]=(n*a-r*i)/s,e[5]=(l*i-t*a)/s},multPoint:function(e,t){var l=t[0],n=t[1];return[l*e[0]+n*e[2]+e[4],l*e[1]+n*e[3]+e[5]]},multArray:function(e,t){for(var l=0;l<t.length;l+=2){var n=t[l],r=t[l+1];t[l]=n*e[0]+r*e[2]+e[4],t[l+1]=n*e[1]+r*e[3]+e[5]}}},UDOC.C={srgbGamma:function(e){return e<.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055},cmykToRgb:function(e){var t=e[0],l=e[1],n=e[2],r=e[3],i=255+t*(-4.387332384609988*t+54.48615194189176*l+18.82290502165302*n+212.25662451639585*r-285.2331026137004)+l*(1.7149763477362134*l-5.6096736904047315*n+-17.873870861415444*r-5.497006427196366)+n*(-2.5217340131683033*n-21.248923337353073*r+17.5119270841813)+r*(-21.86122147463605*r-189.48180835922747),a=255+t*(8.841041422036149*t+60.118027045597366*l+6.871425592049007*n+31.159100130055922*r-79.2970844816548)+l*(-15.310361306967817*l+17.575251261109482*n+131.35250912493976*r-190.9453302588951)+n*(4.444339102852739*n+9.8632861493405*r-24.86741582555878)+r*(-20.737325471181034*r-187.80453709719578),s=255+t*(.8842522430003296*t+8.078677503112928*l+30.89978309703729*n-.23883238689178934*r-14.183576799673286)+l*(10.49593273432072*l+63.02378494754052*n+50.606957656360734*r-112.23884253719248)+n*(.03296041114873217*n+115.60384449646641*r-193.58209356861505)+r*(-22.33816807309886*r-180.12613974708367);return[Math.max(0,Math.min(1,i/255)),Math.max(0,Math.min(1,a/255)),Math.max(0,Math.min(1,s/255))]},labToRgb:function(e){for(var t=903.3,l=.008856,n=e[0],r=e[1],i=(n+16)/116,a=i*i*i,s=i-e[2]/200,o=s*s*s,c=r/500+i,u=c*c*c,h=[96.72*(u>l?u:(116*c-16)/t)/100,100*(a>l?a:(116*i-16)/t)/100,81.427*(o>l?o:(116*s-16)/t)/100],g=[3.1338561,-1.6168667,-.4906146,-.9787684,1.9161415,.033454,.0719453,-.2289914,1.4052427],f=[g[0]*h[0]+g[1]*h[1]+g[2]*h[2],g[3]*h[0]+g[4]*h[1]+g[5]*h[2],g[6]*h[0]+g[7]*h[1]+g[8]*h[2]],m=0;m<3;m++)f[m]=Math.max(0,Math.min(1,UDOC.C.srgbGamma(f[m])));return f}},UDOC.getState=function(e){return{font:UDOC.getFont(),dd:{flat:1},space:"/DeviceGray",ca:1,colr:[0,0,0],sspace:"/DeviceGray",CA:1,COLR:[0,0,0],bmode:"/Normal",SA:!1,OPM:0,AIS:!1,OP:!1,op:!1,SMask:"/None",lwidth:1,lcap:0,ljoin:0,mlimit:10,SM:.1,doff:0,dash:[],ctm:[1,0,0,1,0,0],cpos:[0,0],pth:{cmds:[],crds:[]},cpth:e?UDOC.G.rectToPath(e):null}},UDOC.getFont=function(){return{Tc:0,Tw:0,Th:100,Tl:0,Tf:"Helvetica-Bold",Tfs:1,Tmode:0,Trise:0,Tk:0,Tal:0,Tun:0,Tm:[1,0,0,1,0,0],Tlm:[1,0,0,1,0,0],Trm:[1,0,0,1,0,0]}};let FromEMF=function(){};FromEMF.Parse=function(e,t){e=new Uint8Array(e);for(var l,n=0,r={fill:!1,strk:!1,bb:[0,0,1,1],wbb:[0,0,1,1],fnt:{nam:"Arial",hgh:25,und:!1,orn:0},tclr:[0,0,0],talg:0},i=[],a=[],s=FromEMF.B.readShort,o=FromEMF.B.readUshort,c=FromEMF.B.readInt,u=FromEMF.B.readUint,h=FromEMF.B.readFloat;;){var g=u(e,n);n+=4;var f=FromEMF.K[g],m=u(e,n),d=n+=4,p=null,E=0;if("EOF"==f)break;if("HEADER"==f)r.bb=FromEMF._readBox(e,d),d+=16,t.StartPage(r.bb[0],r.bb[1],r.bb[2],r.bb[3]),l=UDOC.getState(r.bb);else if("SAVEDC"==f)a.push(JSON.stringify(l),JSON.stringify(r));else if("RESTOREDC"==f){var y=c(e,d);for(d+=4;y<-1;)a.pop(),a.pop();r=JSON.parse(a.pop()),l=JSON.parse(a.pop())}else if("SELECTCLIPPATH"==f)l.cpth=JSON.parse(JSON.stringify(l.pth));else if(-1!=["SETMAPMODE","SETPOLYFILLMODE","SETBKMODE","SETICMMODE","SETROP2","EXTSELECTCLIPRGN"].indexOf(f));else if("SETMITERLIMIT"==f)l.mlimit=u(e,d);else if("SETTEXTCOLOR"==f)r.tclr=[e[d]/255,e[d+1]/255,e[d+2]/255];else if("SETTEXTALIGN"==f)r.talg=u(e,d);else if("SETVIEWPORTEXTEX"==f||"SETVIEWPORTORGEX"==f){null==r.vbb&&(r.vbb=[]);var b="SETVIEWPORTORGEX"==f?0:2;r.vbb[b]=c(e,d),d+=4,r.vbb[b+1]=c(e,d),d+=4,"SETVIEWPORTEXTEX"==f&&FromEMF._updateCtm(r,l)}else if("SETWINDOWEXTEX"==f||"SETWINDOWORGEX"==f)b="SETWINDOWORGEX"==f?0:2,r.wbb[b]=c(e,d),d+=4,r.wbb[b+1]=c(e,d),d+=4,"SETWINDOWEXTEX"==f&&FromEMF._updateCtm(r,l);else if("COMMENT"==f)u(e,d),d+=4;else if("SELECTOBJECT"==f){var T=u(e,d);if(d+=4,2147483648==T)r.fill=!0,l.colr=[1,1,1];else if(2147483653==T)r.fill=!1;else if(2147483655==T)r.strk=!0,r.lwidth=1,l.COLR=[0,0,0];else if(2147483656==T)r.strk=!1;else if(2147483661==T);else if(2147483662==T);else{var C=i[T];if("b"==C.t){if(r.fill=1!=C.stl,0==C.stl);else if(1!=C.stl)throw C.stl+" e";l.colr=C.clr}else if("p"==C.t)r.strk=5!=C.stl,l.lwidth=C.wid,l.COLR=C.clr;else{if("f"!=C.t)throw"e";r.fnt=C,l.font.Tf=C.nam,l.font.Tfs=Math.abs(C.hgh),l.font.Tun=C.und}}}else if("DELETEOBJECT"==f){if(T=u(e,d),d+=4,null==i[T])throw"e";i[T]=null}else if("CREATEBRUSHINDIRECT"==f)E=u(e,d),(p={t:"b"}).stl=u(e,d+=4),d+=4,p.clr=[e[d]/255,e[d+1]/255,e[d+2]/255],d+=4,p.htc=u(e,d),d+=4;else if("CREATEPEN"==f||"EXTCREATEPEN"==f)E=u(e,d),d+=4,p={t:"p"},"EXTCREATEPEN"==f?(d+=16,p.stl=u(e,d),d+=4,p.wid=u(e,d),d+=4,d+=4):(p.stl=u(e,d),d+=4,p.wid=u(e,d),d+=4,d+=4),p.clr=[e[d]/255,e[d+1]/255,e[d+2]/255],d+=4;else if("EXTCREATEFONTINDIRECTW"==f){E=u(e,d),(p={t:"f",nam:""}).hgh=c(e,d+=4),d+=4,d+=8,p.orn=c(e,d)/10;var I=u(e,d+=4);for(d+=4,p.und=e[d+1],p.stk=e[d+2],d+=8;0!=o(e,d);)p.nam+=String.fromCharCode(o(e,d)),d+=2;I>500&&(p.nam+="-Bold")}else if("EXTTEXTOUTW"==f){var v=u(e,d+=16);h(e,d+=4),h(e,d+=4);var R=c(e,d+=4),w=c(e,d+=4);d+=4,l.font.Tm=[1,0,0,-1,0,0],UDOC.M.rotate(l.font.Tm,r.fnt.orn*Math.PI/180),UDOC.M.translate(l.font.Tm,R,w);var L=r.talg;if(6&~L){if(7&L)throw L+" e";l.font.Tal=0}else l.font.Tal=2;if(24&~L){if(24&L)throw"e";UDOC.M.translate(l.font.Tm,0,l.font.Tfs)}var F=u(e,d),S=u(e,d+=4);u(e,d+=4),d+=4,u(e,d+=16),d+=4,S+=n-8;for(var x="",A=0;A<F;A++){var O=o(e,S+2*A);x+=String.fromCharCode(O)}var M=l.colr;l.colr=r.tclr,t.PutText(l,x,x.length*l.font.Tfs*.5),l.colr=M}else if("BEGINPATH"==f)UDOC.G.newPath(l);else if("ENDPATH"==f);else if("CLOSEFIGURE"==f)UDOC.G.closePath(l);else if("MOVETOEX"==f)UDOC.G.moveTo(l,c(e,d),c(e,d+4));else if("LINETO"==f){if(0==l.pth.cmds.length){var N=l.ctm.slice(0);UDOC.M.invert(N);var B=UDOC.M.multPoint(N,l.cpos);UDOC.G.moveTo(l,B[0],B[1])}UDOC.G.lineTo(l,c(e,d),c(e,d+4))}else if("POLYGON"==f||"POLYGON16"==f||"POLYLINE"==f||"POLYLINE16"==f||"POLYLINETO"==f||"POLYLINETO16"==f){d+=16;var k=f.startsWith("POLYGON"),_=-1!=f.indexOf("TO"),P=u(e,d);d+=4,_||UDOC.G.newPath(l),d=FromEMF._drawPoly(e,d,P,l,f.endsWith("16")?2:4,k,_),_||FromEMF._draw(t,l,r,k)}else if("POLYPOLYGON16"==f){d+=16,k=f.startsWith("POLYPOLYGON"),_=-1!=f.indexOf("TO");var D=u(e,d);d+=4;var X=d+=4;for(d+=4*D,_||UDOC.G.newPath(l),A=0;A<D;A++){var U=o(e,X+4*A);d=FromEMF._drawPoly(e,d,U,l,f.endsWith("16")?2:4,k,_)}_||FromEMF._draw(t,l,r,k)}else if("POLYBEZIER"==f||"POLYBEZIER16"==f||"POLYBEZIERTO"==f||"POLYBEZIERTO16"==f){d+=16;var V=f.endsWith("16"),G=V?s:c,H=V?2:4;for(P=u(e,d),d+=4,-1==f.indexOf("TO")&&(UDOC.G.moveTo(l,G(e,d),G(e,d+H)),d+=2*H,P--);P>0;)UDOC.G.curveTo(l,G(e,d),G(e,d+H),G(e,d+2*H),G(e,d+3*H),G(e,d+4*H),G(e,d+5*H)),d+=6*H,P-=3}else if("RECTANGLE"==f||"ELLIPSE"==f){UDOC.G.newPath(l);var W=FromEMF._readBox(e,d);if("RECTANGLE"==f)UDOC.G.moveTo(l,W[0],W[1]),UDOC.G.lineTo(l,W[2],W[1]),UDOC.G.lineTo(l,W[2],W[3]),UDOC.G.lineTo(l,W[0],W[3]);else{var z=(W[0]+W[2])/2,q=(W[1]+W[3])/2;UDOC.G.arc(l,z,q,(W[2]-W[0])/2,0,2*Math.PI,!1)}UDOC.G.closePath(l),FromEMF._draw(t,l,r,!0)}else if("FILLPATH"==f)t.Fill(l,!1);else if("STROKEPATH"==f)t.Stroke(l);else if("STROKEANDFILLPATH"==f)t.Fill(l,!1),t.Stroke(l);else if("SETWORLDTRANSFORM"==f||"MODIFYWORLDTRANSFORM"==f){var j=[];for(A=0;A<6;A++)j.push(h(e,d+4*A));if(d+=24,"SETWORLDTRANSFORM"==f)l.ctm=j;else{if(v=u(e,d),d+=4,2!=v)throw"e";var Y=l.ctm;l.ctm=j,UDOC.M.concat(l.ctm,Y)}}else if("SETSTRETCHBLTMODE"==f)u(e,d),d+=4;else if("STRETCHDIBITS"==f){W=FromEMF._readBox(e,d);var Z=c(e,d+=16),$=c(e,d+=4);c(e,d+=4),c(e,d+=4);var J=c(e,d+=4),K=c(e,d+=4),Q=u(e,d+=4)+n-8;u(e,d+=4);var ee=u(e,d+=4)+n-8;if(u(e,d+=4),0!=u(e,d+=4))throw"e";u(e,d+=4);var te=c(e,d+=4),le=c(e,d+=4);d+=4,u(e,Q);var ne=u(e,Q+=4),re=u(e,Q+=4);if(ne!=J||re!=K)throw"e";var ie=o(e,Q+=4),ae=o(e,Q+=2);if(8!=ae&&24!=ae&&32!=ae)throw ae+" e";var se=u(e,Q+=2);if(0!=se)throw se+" e";u(e,Q+=4),u(e,Q+=4),u(e,Q+=4),u(e,Q+=4),u(e,Q+=4),Q+=4;var oe=Math.floor((ne*ie*ae+31&-32)/8),ce=new Uint8Array(ne*re*4);if(8==ae)for(q=0;q<re;q++)for(z=0;z<ne;z++){var ue=q*ne+z<<2;T=e[ee+(re-1-q)*oe+z]<<2,ce[ue]=e[Q+T+2],ce[ue+1]=e[Q+T+1],ce[ue+2]=e[Q+T+0],ce[ue+3]=255}if(24==ae)for(q=0;q<re;q++)for(z=0;z<ne;z++){var he=ee+(re-1-q)*oe+3*z;ce[ue=q*ne+z<<2]=e[he+2],ce[ue+1]=e[he+1],ce[ue+2]=e[he+0],ce[ue+3]=255}if(32==ae)for(q=0;q<re;q++)for(z=0;z<ne;z++)he=ee+(re-1-q)*oe+4*z,ce[ue=q*ne+z<<2]=e[he+2],ce[ue+1]=e[he+1],ce[ue+2]=e[he+0],ce[ue+3]=e[he+3];var ge=l.ctm.slice(0);l.ctm=[1,0,0,1,0,0],UDOC.M.scale(l.ctm,te,-le),UDOC.M.translate(l.ctm,Z,$+le),UDOC.M.concat(l.ctm,ge),t.PutImage(l,ce,ne,re),l.ctm=ge}null!=p&&(i[E]=p),n+=m-8}t.ShowPage(),t.Done()},FromEMF._readBox=function(e,t){for(var l=[],n=0;n<4;n++)l[n]=FromEMF.B.readInt(e,t+4*n);return l},FromEMF._updateCtm=function(e,t){var l=[1,0,0,1,0,0],n=e.wbb;e.bb;var r=e.vbb&&4==e.vbb.length?e.vbb:e.bb;UDOC.M.translate(l,-n[0],-n[1]),UDOC.M.scale(l,1/n[2],1/n[3]),UDOC.M.scale(l,r[2],r[3]),t.ctm=l},FromEMF._draw=function(e,t,l,n){l.fill&&n&&e.Fill(t,!1),l.strk&&0!=t.lwidth&&e.Stroke(t)},FromEMF._drawPoly=function(e,t,l,n,r,i,a){for(var s=2==r?FromEMF.B.readShort:FromEMF.B.readInt,o=0;o<l;o++){var c=s(e,t),u=s(e,t+=r);t+=r,0!=o||a?UDOC.G.lineTo(n,c,u):UDOC.G.moveTo(n,c,u)}return i&&UDOC.G.closePath(n),t},(FromEMF.B={uint8:new Uint8Array(4),readShort:function(e,t){var l=FromEMF.B.uint8;return l[0]=e[t],l[1]=e[t+1],FromEMF.B.int16[0]},readUshort:function(e,t){var l=FromEMF.B.uint8;return l[0]=e[t],l[1]=e[t+1],FromEMF.B.uint16[0]},readInt:function(e,t){var l=FromEMF.B.uint8;return l[0]=e[t],l[1]=e[t+1],l[2]=e[t+2],l[3]=e[t+3],FromEMF.B.int32[0]},readUint:function(e,t){var l=FromEMF.B.uint8;return l[0]=e[t],l[1]=e[t+1],l[2]=e[t+2],l[3]=e[t+3],FromEMF.B.uint32[0]},readFloat:function(e,t){var l=FromEMF.B.uint8;return l[0]=e[t],l[1]=e[t+1],l[2]=e[t+2],l[3]=e[t+3],FromEMF.B.flot32[0]},readASCII:function(e,t,l){for(var n="",r=0;r<l;r++)n+=String.fromCharCode(e[t+r]);return n}}).int16=new Int16Array(FromEMF.B.uint8.buffer),FromEMF.B.uint16=new Uint16Array(FromEMF.B.uint8.buffer),FromEMF.B.int32=new Int32Array(FromEMF.B.uint8.buffer),FromEMF.B.uint32=new Uint32Array(FromEMF.B.uint8.buffer),FromEMF.B.flot32=new Float32Array(FromEMF.B.uint8.buffer),FromEMF.C={EMR_HEADER:1,EMR_POLYBEZIER:2,EMR_POLYGON:3,EMR_POLYLINE:4,EMR_POLYBEZIERTO:5,EMR_POLYLINETO:6,EMR_POLYPOLYLINE:7,EMR_POLYPOLYGON:8,EMR_SETWINDOWEXTEX:9,EMR_SETWINDOWORGEX:10,EMR_SETVIEWPORTEXTEX:11,EMR_SETVIEWPORTORGEX:12,EMR_SETBRUSHORGEX:13,EMR_EOF:14,EMR_SETPIXELV:15,EMR_SETMAPPERFLAGS:16,EMR_SETMAPMODE:17,EMR_SETBKMODE:18,EMR_SETPOLYFILLMODE:19,EMR_SETROP2:20,EMR_SETSTRETCHBLTMODE:21,EMR_SETTEXTALIGN:22,EMR_SETCOLORADJUSTMENT:23,EMR_SETTEXTCOLOR:24,EMR_SETBKCOLOR:25,EMR_OFFSETCLIPRGN:26,EMR_MOVETOEX:27,EMR_SETMETARGN:28,EMR_EXCLUDECLIPRECT:29,EMR_INTERSECTCLIPRECT:30,EMR_SCALEVIEWPORTEXTEX:31,EMR_SCALEWINDOWEXTEX:32,EMR_SAVEDC:33,EMR_RESTOREDC:34,EMR_SETWORLDTRANSFORM:35,EMR_MODIFYWORLDTRANSFORM:36,EMR_SELECTOBJECT:37,EMR_CREATEPEN:38,EMR_CREATEBRUSHINDIRECT:39,EMR_DELETEOBJECT:40,EMR_ANGLEARC:41,EMR_ELLIPSE:42,EMR_RECTANGLE:43,EMR_ROUNDRECT:44,EMR_ARC:45,EMR_CHORD:46,EMR_PIE:47,EMR_SELECTPALETTE:48,EMR_CREATEPALETTE:49,EMR_SETPALETTEENTRIES:50,EMR_RESIZEPALETTE:51,EMR_REALIZEPALETTE:52,EMR_EXTFLOODFILL:53,EMR_LINETO:54,EMR_ARCTO:55,EMR_POLYDRAW:56,EMR_SETARCDIRECTION:57,EMR_SETMITERLIMIT:58,EMR_BEGINPATH:59,EMR_ENDPATH:60,EMR_CLOSEFIGURE:61,EMR_FILLPATH:62,EMR_STROKEANDFILLPATH:63,EMR_STROKEPATH:64,EMR_FLATTENPATH:65,EMR_WIDENPATH:66,EMR_SELECTCLIPPATH:67,EMR_ABORTPATH:68,EMR_COMMENT:70,EMR_FILLRGN:71,EMR_FRAMERGN:72,EMR_INVERTRGN:73,EMR_PAINTRGN:74,EMR_EXTSELECTCLIPRGN:75,EMR_BITBLT:76,EMR_STRETCHBLT:77,EMR_MASKBLT:78,EMR_PLGBLT:79,EMR_SETDIBITSTODEVICE:80,EMR_STRETCHDIBITS:81,EMR_EXTCREATEFONTINDIRECTW:82,EMR_EXTTEXTOUTA:83,EMR_EXTTEXTOUTW:84,EMR_POLYBEZIER16:85,EMR_POLYGON16:86,EMR_POLYLINE16:87,EMR_POLYBEZIERTO16:88,EMR_POLYLINETO16:89,EMR_POLYPOLYLINE16:90,EMR_POLYPOLYGON16:91,EMR_POLYDRAW16:92,EMR_CREATEMONOBRUSH:93,EMR_CREATEDIBPATTERNBRUSHPT:94,EMR_EXTCREATEPEN:95,EMR_POLYTEXTOUTA:96,EMR_POLYTEXTOUTW:97,EMR_SETICMMODE:98,EMR_CREATECOLORSPACE:99,EMR_SETCOLORSPACE:100,EMR_DELETECOLORSPACE:101,EMR_GLSRECORD:102,EMR_GLSBOUNDEDRECORD:103,EMR_PIXELFORMAT:104,EMR_DRAWESCAPE:105,EMR_EXTESCAPE:106,EMR_SMALLTEXTOUT:108,EMR_FORCEUFIMAPPING:109,EMR_NAMEDESCAPE:110,EMR_COLORCORRECTPALETTE:111,EMR_SETICMPROFILEA:112,EMR_SETICMPROFILEW:113,EMR_ALPHABLEND:114,EMR_SETLAYOUT:115,EMR_TRANSPARENTBLT:116,EMR_GRADIENTFILL:118,EMR_SETLINKEDUFIS:119,EMR_SETTEXTJUSTIFICATION:120,EMR_COLORMATCHTOTARGETW:121,EMR_CREATECOLORSPACEW:122},FromEMF.K=[];let ToContext2D=function(e,t){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.bb=null,this.currPage=0,this.needPage=e,this.scale=t};function _flt(e){return""+parseFloat(e.toFixed(2))}ToContext2D.prototype.StartPage=function(e,t,l,n){if(this.currPage==this.needPage){this.bb=[e,t,l,n];var r=this.scale,i=window.devicePixelRatio,a=this.canvas,s=this.ctx;a.width=Math.round(l*r),a.height=Math.round(n*r),s.translate(0,n*r),s.scale(r,-r),a.setAttribute("style","border:1px solid; width:"+a.width/i+"px; height:"+a.height/i+"px")}},ToContext2D.prototype.Fill=function(e,t){if(this.currPage==this.needPage){var l=this.ctx;l.beginPath(),this._setStyle(e,l),this._draw(e.pth,l),l.fill()}},ToContext2D.prototype.Stroke=function(e){if(this.currPage==this.needPage){var t=this.ctx;t.beginPath(),this._setStyle(e,t),this._draw(e.pth,t),t.stroke()}},ToContext2D.prototype.PutText=function(e,t,l){if(this.currPage==this.needPage){this._scale(e.ctm);var n=this.ctx;this._setStyle(e,n),n.save();var r=[1,0,0,-1,0,0];this._concat(r,e.font.Tm),this._concat(r,e.ctm),n.transform(r[0],r[1],r[2],r[3],r[4],r[5]),n.fillText(t,0,0),n.restore()}},ToContext2D.prototype.PutImage=function(e,t,l,n,r){if(this.currPage==this.needPage){var i=this.ctx;if(t.length==l*n*4){if(t=t.slice(0),r&&r.length==l*n*4)for(var a=0;a<t.length;a+=4)t[a+3]=r[a+1];var s=document.createElement("canvas"),o=s.getContext("2d");s.width=l,s.height=n;var c=o.createImageData(l,n);for(a=0;a<t.length;a++)c.data[a]=t[a];o.putImageData(c,0,0),i.save();var u=[1,0,0,1,0,0];this._concat(u,[1/l,0,0,-1/n,0,1]),this._concat(u,e.ctm),i.transform(u[0],u[1],u[2],u[3],u[4],u[5]),i.drawImage(s,0,0),i.restore()}}},ToContext2D.prototype.ShowPage=function(){this.currPage++},ToContext2D.prototype.Done=function(){},ToContext2D.prototype._setStyle=function(e,t){var l=this._scale(e.ctm);t.fillStyle=this._getFill(e.colr,e.ca,t),t.strokeStyle=this._getFill(e.COLR,e.CA,t),t.lineCap=["butt","round","square"][e.lcap],t.lineJoin=["miter","round","bevel"][e.ljoin],t.lineWidth=e.lwidth*l;for(var n=e.dash.slice(0),r=0;r<n.length;r++)n[r]=_flt(n[r]*l);t.setLineDash(n),t.miterLimit=e.mlimit*l;var i=e.font.Tf,a=i.toLowerCase(),s=-1!=a.indexOf("bold")?"bold ":"",o=-1!=a.indexOf("italic")||-1!=a.indexOf("oblique")?"italic ":"";t.font=s+o+e.font.Tfs+'px "'+i+'"'},ToContext2D.prototype._getFill=function(e,t,l){if(null==e.typ)return this._colr(e,t);var n,r=e,i=r.crds,a=r.mat,s=this._scale(a);if("lin"==r.typ){var o=this._multPoint(a,i.slice(0,2)),c=this._multPoint(a,i.slice(2));n=l.createLinearGradient(o[0],o[1],c[0],c[1])}else"rad"==r.typ&&(o=this._multPoint(a,i.slice(0,2)),c=this._multPoint(a,i.slice(3)),n=l.createRadialGradient(o[0],o[1],i[2]*s,c[0],c[1],i[5]*s));for(var u=0;u<r.grad.length;u++)n.addColorStop(r.grad[u][0],this._colr(r.grad[u][1],t));return n},ToContext2D.prototype._colr=function(e,t){return"rgba("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+","+t+")"},ToContext2D.prototype._scale=function(e){return Math.sqrt(Math.abs(e[0]*e[3]-e[1]*e[2]))},ToContext2D.prototype._concat=function(e,t){var l=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5];e[0]=l*t[0]+n*t[2],e[1]=l*t[1]+n*t[3],e[2]=r*t[0]+i*t[2],e[3]=r*t[1]+i*t[3],e[4]=a*t[0]+s*t[2]+t[4],e[5]=a*t[1]+s*t[3]+t[5]},ToContext2D.prototype._multPoint=function(e,t){var l=t[0],n=t[1];return[l*e[0]+n*e[2]+e[4],l*e[1]+n*e[3]+e[5]]},ToContext2D.prototype._draw=function(e,t){for(var l=0,n=e.crds,r=0;r<e.cmds.length;r++){var i=e.cmds[r];"M"==i?(t.moveTo(n[l],n[l+1]),l+=2):"L"==i?(t.lineTo(n[l],n[l+1]),l+=2):"C"==i?(t.bezierCurveTo(n[l],n[l+1],n[l+2],n[l+3],n[l+4],n[l+5]),l+=6):"Q"==i?(t.quadraticCurveTo(n[l],n[l+1],n[l+2],n[l+3]),l+=4):"Z"==i&&t.closePath()}};class ImageList{constructor(e){if(null!=e){this.images={};for(let i in e)if(i.indexOf("xl/media/")>-1){let a=i.split("."),s=a[a.length-1].toLowerCase();if(s in{png:1,jpeg:1,jpg:1,gif:1,bmp:1,tif:1,webp:1,emf:1})if("emf"==s){var t,l,n=new ToContext2D(0,1);for(var r in l=FromEMF.K=[],t=FromEMF.C)l[t[r]]=r.slice(4);FromEMF.Parse(e[i],n),this.images[i]=n.canvas.toDataURL("image/png")}else this.images[i]=e[i]}}}getImageByName(e){if(e in this.images){let t=this.images[e];return new Image(e,t)}return null}}class Image extends LuckyImageBase{constructor(e,t){super(),this.src=t,this.id=generateRandomIndex("image")}setDefault(){}}class LuckyDefineNames{constructor(e){let t=e.getElementsByTagName("definedNames/definedName","xl/workbook.xml");const l={};t.forEach(e=>{const t=new LuckyDefineName(e);l[t.id]=t}),this.defineNames=l}}class LuckyDefineName{constructor(e){this.id=generateRandomId(6),this.name=e.get("name"),this.formulaOrRefString=escapeCharacter(e.value),this.comment=e.get("comment"),this.localSheetId=e.get("localSheetId"),this.hidden="1"===e.get("hidden")}}class LuckyFile extends LuckyFileBase{constructor(e,t){super(),this.columnWidthSet=[],this.rowHeightSet=[],this.handleWorkBookInfo=()=>{this.workbook=new WorkBookInfo;const e=new LuckyDefineNames(this.readXml);e?.defineNames&&(this.workbook.defineNames=e.defineNames)},this.files=e,this.fileName=t,this.readXml=new ReadXml(e),this.getSheetNameList(),this.sharedStrings=this.readXml.getElementsByTagName("sst/si","xl/sharedStrings.xml"),this.calcChain=this.readXml.getElementsByTagName("calcChain/c","xl/calcChain.xml"),this.styles={},this.styles.cellXfs=this.readXml.getElementsByTagName("cellXfs/xf",stylesFile),this.styles.cellStyleXfs=this.readXml.getElementsByTagName("cellStyleXfs/xf",stylesFile),this.styles.cellStyles=this.readXml.getElementsByTagName("cellStyles/cellStyle",stylesFile),this.styles.fonts=this.readXml.getElementsByTagName("fonts/font",stylesFile),this.styles.fills=this.readXml.getElementsByTagName("fills/fill",stylesFile),this.styles.borders=this.readXml.getElementsByTagName("borders/border",stylesFile),this.styles.clrScheme=this.readXml.getElementsByTagName("a:clrScheme/a:dk1|a:lt1|a:dk2|a:lt2|a:accent1|a:accent2|a:accent3|a:accent4|a:accent5|a:accent6|a:hlink|a:folHlink","xl/theme/theme1.xml"),this.styles.indexedColors=this.readXml.getElementsByTagName("colors/indexedColors/rgbColor",stylesFile),this.styles.mruColors=this.readXml.getElementsByTagName("colors/mruColors/color",stylesFile),this.styles.dxfs=this.readXml.getElementsByTagName("dxfs/dxf",stylesFile),this.imageList=new ImageList(e),this.cellImages=this.readXml.getElementsByTagName("etc:cellImages/etc:cellImage","xl/cellimages.xml");let l=this.readXml.getElementsByTagName("numFmt/numFmt",stylesFile),n=JSON.parse(JSON.stringify(numFmtDefault));for(let e=0;e<l.length;e++){let t=l[e].attributeList,r=getXmlAttibute(t,"numFmtId","49"),i=getXmlAttibute(t,"formatCode","@");r in numFmtDefault||(n[r]=numFmtDefaultMap[i]||i)}this.styles.numfmts=n}getSheetNameList(){let e=this.readXml.getElementsByTagName("Relationships/Relationship","xl/_rels/workbook.xml.rels");if(null==e)return;let t=new RegExp("worksheets/[^/]*?.xml"),l={};for(let n=0;n<e.length;n++){let r=e[n].attributeList,i=r.Id,a=r.Target;t.test(a)&&(0===a.indexOf("/xl")?l[i]=a.substr(1):l[i]="xl/"+a)}this.sheetNameList=l}getSheetFileBysheetId(e){return this.sheetNameList[e]}getWorkBookInfo(){let e=this.readXml.getElementsByTagName("Company","docProps/app.xml"),t=this.readXml.getElementsByTagName("AppVersion","docProps/app.xml"),l=this.readXml.getElementsByTagName("dc:creator",coreFile),n=this.readXml.getElementsByTagName("cp:lastModifiedBy",coreFile),r=this.readXml.getElementsByTagName("dcterms:created",coreFile),i=this.readXml.getElementsByTagName("dcterms:modified",coreFile);this.info=new LuckyFileInfo,this.info.name=this.fileName,this.info.creator=l.length>0?l[0].value:"",this.info.lastmodifiedby=n.length>0?n[0].value:"",this.info.createdTime=r.length>0?r[0].value:"",this.info.modifiedTime=i.length>0?i[0].value:"",this.info.company=e.length>0?e[0].value:"",this.info.appversion=t.length>0?t[0].value:""}getSheetsFull(e=!0){let t=this.readXml.getElementsByTagName("sheets/sheet","xl/workbook.xml"),l={};for(let e in t){let n=t[e];l[n.attributeList.name]=n.attributeList.sheetId}this.sheets=[];let n=0;for(let r in t){let i,a,s=t[r],o=s.attributeList.name,c=s.attributeList.sheetId,u=s.attributeList["r:id"],h=this.getSheetFileBysheetId(u),g="hidden"===s.attributeList.state?1:0,f=this.readXml.getElementsByTagName("worksheet/drawing",h);if(null!=f&&f.length>0){let e=getXmlAttibute(f[0].attributeList,"r:id",null);null!=e&&(i=this.getDrawingFile(e,h),a=this.getDrawingRelsFile(i))}if(null!=h){let t=new LuckySheet(o,c,n,e,{sheetFile:h,readXml:this.readXml,sheetList:l,styles:this.styles,sharedStrings:this.sharedStrings,calcChain:this.calcChain,imageList:this.imageList,drawingFile:i,drawingRelsFile:a,hide:g,cellImages:this.cellImages});this.columnWidthSet=[],this.rowHeightSet=[],this.imagePositionCaculation(t),this.sheets.push(t),n++}}}extendArray(e,t,l,n,r){if(e<t.length)return;let i=t.length,a=e,s=0;i>0&&(s=t[i-1]);for(let e=i;e<=a;e++){let i=l,a=e.toString();a in n?i=0:a in r&&(i=r[a]),s+=Math.round(i+1),t.push(s)}}imagePositionCaculation(e){let t=e.images,l=e.defaultColWidth,n=e.defaultRowHeight,r={};e.config.colhidden&&(r=e.config.colhidden);let i={};e.config.columnlen&&(i=e.config.columnlen);let a={};e.config.rowhidden&&(a=e.config.rowhidden);let s={};e.config.rowlen&&(s=e.config.rowlen);for(let e in t){let o=t[e],c=o.fromCol,u=o.fromColOff,h=o.fromRow,g=o.fromRowOff,f=o.toCol,m=o.toColOff,d=o.toRow,p=o.toRowOff,E=0,y=0,b=0,T=0;c>=this.columnWidthSet.length&&this.extendArray(c,this.columnWidthSet,l,r,i),E=0==c?0:this.columnWidthSet[c-1],E+=u,h>=this.rowHeightSet.length&&this.extendArray(h,this.rowHeightSet,n,a,s),y=0==h?0:this.rowHeightSet[h-1],y+=g,f>=this.columnWidthSet.length&&this.extendArray(f,this.columnWidthSet,l,r,i),b=0==f?0:this.columnWidthSet[f-1],b=b+m-E,d>=this.rowHeightSet.length&&this.extendArray(d,this.rowHeightSet,n,a,s),T=0==d?0:this.rowHeightSet[d-1],T=T+p-y,o.originWidth=b,o.originHeight=T,o.crop.height=T,o.crop.width=b,o.default.height=T,o.default.left=E,o.default.top=y,o.default.width=b}}getDrawingFile(e,t){let l=t.split("/"),n="xl/worksheets/_rels/"+l[l.length-1]+".rels",r=this.readXml.getElementsByTagName("Relationships/Relationship",n);if(r.length>0)for(let t=0;t<r.length;t++){let l=r[t].attributeList;if(getXmlAttibute(l,"Id",null)==e){let e=getXmlAttibute(l,"Target",null);if(null!=e)return e.replace(/\.\.\//g,"")}}return null}getDrawingRelsFile(e){let t=e.split("/");return"xl/drawings/_rels/"+t[t.length-1]+".rels"}getSheetsWithoutCell(){this.getSheetsFull(!1)}Parse(){return this.getWorkBookInfo(),this.handleWorkBookInfo(),this.getSheetsFull(),this.toJsonString(this)}toJsonString(e){let t=new LuckyFileBase;return t.info=e.info,t.workbook=e.workbook,t.sheets=[],e.sheets.forEach(e=>{let l=new LuckySheetBase;null!=e.name&&(l.name=e.name),null!=e.color&&(l.color=e.color),null!=e.config&&(l.config=e.config),null!=e.index&&(l.index=e.index),null!=e.status&&(l.status=e.status),null!=e.order&&(l.order=e.order),null!=e.row&&(l.row=e.row),null!=e.column&&(l.column=e.column),null!=e.luckysheet_select_save&&(l.luckysheet_select_save=e.luckysheet_select_save),null!=e.scrollLeft&&(l.scrollLeft=e.scrollLeft),null!=e.scrollTop&&(l.scrollTop=e.scrollTop),null!=e.zoomRatio&&(l.zoomRatio=e.zoomRatio),null!=e.showGridLines&&(l.showGridLines=e.showGridLines),null!=e.defaultColWidth&&(l.defaultColWidth=e.defaultColWidth),null!=e.defaultRowHeight&&(l.defaultRowHeight=e.defaultRowHeight),null!=e.celldata&&(l.celldata=[],e.celldata.forEach(e=>{let t=new LuckySheetCelldataBase;t.r=e.r,t.c=e.c,t.v=e.v,l.celldata.push(t)})),null!=e.chart&&(l.chart=e.chart),null!=e.isPivotTable&&(l.isPivotTable=e.isPivotTable),null!=e.pivotTable&&(l.pivotTable=e.pivotTable),null!=e.luckysheet_conditionformat_save&&(l.luckysheet_conditionformat_save=e.luckysheet_conditionformat_save),null!=e.freezen&&(l.freezen=e.freezen),null!=e.calcChain&&(l.calcChain=e.calcChain),null!=e.images&&(l.images=e.images),null!=e.charts&&(l.charts=e.charts),null!=e.dataVerification&&(l.dataVerification=e.dataVerification),null!=e.hyperlink&&(l.hyperlink=e.hyperlink),null!=e.hide&&(l.hide=e.hide),null!=e.conditionalFormatting&&e.conditionalFormatting.length&&(l.conditionalFormatting=e.conditionalFormatting),null!=e.dataVerificationList&&e.dataVerificationList.length&&(l.dataVerificationList=e.dataVerificationList),null!=e.filter&&(l.filter=e.filter),t.sheets.push(l)}),JSON.stringify(t)}}class HandleZip{constructor(e){this.uploadFile=e}unzipFile(e,t){(new JSZip__default.default).loadAsync(this.uploadFile).then(function(t){let l={},n=Object.keys(t.files).length,r=0;t.forEach(function(t,i){let a=i.name.split("."),s=a[a.length-1].toLowerCase(),o="string";s in{png:1,jpeg:1,jpg:1,gif:1,bmp:1,tif:1,webp:1}?o="base64":"emf"==s&&(o="arraybuffer"),i.async(o).then(function(t){"base64"==o&&(t="data:image/"+s+";base64,"+t),l[i.name]=t,n==r+1&&e(l),r++})})},function(e){t(e)})}unzipFileByUrl(e,t,l){var n=new JSZip__default.default;!function(e,t){let l,n,r;t||(t={});let i=function(){try{return new window.XMLHttpRequest}catch(e){}};var a="undefined"!=typeof window&&window.ActiveXObject?function(){return i()||function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}()}:i;"function"==typeof t?(r=t,t={}):"function"==typeof t.callback&&(r=t.callback),l=function(e){r(null,e)},n=function(e){r(e,null)};try{var s=a();s.open("GET",e,!0),"responseType"in s&&(s.responseType="arraybuffer"),s.overrideMimeType&&s.overrideMimeType("text/plain; charset=x-user-defined"),s.onreadystatechange=function(t){if(4===s.readyState)if(200===s.status||0===s.status)try{l(function(e){return e.response||e.responseText}(s))}catch(e){n(new Error(e))}else n(new Error("Ajax error for "+e+" : "+this.status+" "+this.statusText))},t.progress&&(s.onprogress=function(l){t.progress({path:e,originalEvent:l,percent:l.loaded/l.total*100,loaded:l.loaded,total:l.total})}),s.send()}catch(e){n(new Error(e))}}(e,function(e,r){if(e)throw e;n.loadAsync(r).then(function(e){let l={},n=Object.keys(e.files).length,r=0;e.forEach(function(e,i){let a=i.name.split("."),s=a[a.length-1].toLowerCase(),o="string";s in{png:1,jpeg:1,jpg:1,gif:1,bmp:1,tif:1,webp:1}?o="base64":"emf"==s&&(o="arraybuffer"),i.async(o).then(function(e){"base64"==o&&(e="data:image/"+s+";base64,"+e),l[i.name]=e,n==r+1&&t(l),r++})})},function(e){l(e)})})}newZipFile(){var e=new JSZip__default.default;this.workBook=e}addToZipFile(e,t){if(null==this.workBook){var l=new JSZip__default.default;this.workBook=l}this.workBook.file(e,t)}}function hex2argb(e,t=""){if(!e)return e;const l=colors[e];return l&&(e=l),e.toLocaleUpperCase().replace("#",t)}const colors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function heightConvert(e){return e/96*72}function wdithConvert(e){return(e-10)/8+.83+.64}function isUndefined(e,t){if(void 0!==e)return void 0===t?e:t}function cellStyle(e={},t,l=!1){return{numFmt:t,font:fontConvert(e),alignment:alignmentConvert(e),protection:null,border:borderConvert(e.bd),fill:fillConvert(e.bg?.rgb,l)}}function fontConvert(e){const t={underline:{10:"double",12:"single"},vertAlign:{1:void 0,2:"subscript",3:"superscript"}};return{name:e.ff,size:e.fs,family:1,color:isUndefined(e.cl?.rgb,{argb:hex2argb(e.cl?.rgb)}),bold:isUndefined(e.bl,1===e.bl),italic:isUndefined(e.it,1===e.it),underline:isUndefined(e.ul?.s,1===e.ul?.s&&(t.underline[e.ul.t]||!0)),vertAlign:isUndefined(e.va,t.vertAlign[e.va]),strike:isUndefined(e.st?.s,1===e.st?.s),outline:isUndefined(e.ol?.s,1===e.ol?.s),charset:134}}function borderConvert(e){if(!e)return null;const t={0:"none",1:"thin",2:"hair",3:"dotted",4:"dashDot",5:"dashDot",6:"dashDotDot",7:"double",8:"medium",9:"mediumDashed",10:"mediumDashDot",11:"mediumDashDotDot",12:"slantDashDot",13:"thick"},l=e=>{if(e)return{style:t[e?.s||1],color:{argb:hex2argb(e?.cl?.rgb||"#d9d9d9")}}},n=l(e.bl_tr||e.tl_br)||{};return{top:l(e.t),right:l(e.r),bottom:l(e.b),left:l(e.l),diagonal:{up:!!e.bl_tr,down:!!e.tl_br,...n}}}function alignmentConvert(e){const t={horizontal:{0:"left",1:"left",2:"center",3:"right"},vertical:{1:"top",2:"middle",3:"bottom"},wrapText:{3:!0}};return{horizontal:isUndefined(e.ht,t.horizontal[e.ht]),vertical:isUndefined(e.vt,t.vertical[e.vt]),wrapText:isUndefined(e.tb,3===e.tb),textRotation:isUndefined(e.tr?.a)}}function fillConvert(e,t=!1){if(!e)return null;if(!e)return{type:"pattern",pattern:"none"};const l={type:"pattern",pattern:"solid"};return t?l.bgColor={argb:hex2argb(e,"FF")}:l.fgColor={argb:hex2argb(e,"FF")},l}class Resource{constructor(e,t,l,n){this.sheetId=e,this.workbook=t,this.worksheet=l,this.resources=n,this.setImages(),this.setConditional(),this.setDataValidation(),this.setFilter()}handleRang(e){const{startRow:t,startColumn:l,endRow:n,endColumn:r}=e;return function(e){let t=e.row[0],l=e.row[1],n=e.column[0],r=e.column[1];return null==t&&null==l?numberToABC(n)+":"+numberToABC(r):null==n&&null==r?t+1+":"+(l+1):n==r&&t==l?""+numberToABC(n)+(t+1):""+numberToABC(n)+(t+1)+":"+numberToABC(r)+(l+1)}({row:[t,n],column:[l,r]})}setFilter(){const e=this.getSheetResource("SHEET_FILTER_PLUGIN");e&&(this.worksheet.autoFilter=this.handleRang(e.ref))}setConditional(){const e=this.getSheetResource("SHEET_CONDITIONAL_FORMATTING_PLUGIN"),t=[];e&&(e.forEach(e=>{const{ranges:l,rule:n,stopIfTrue:r}=e;l.forEach(l=>{const n=this.handleRang(l),r=t.findIndex(e=>e.ref===n),i=this.handleRule(e);r>-1?t[r].rules.push(i):t.push({ref:n,rules:[i]})})}),t.forEach(e=>{this.worksheet.addConditionalFormatting(e)}))}setDataValidation(){const e=this.getSheetResource("SHEET_DATA_VALIDATION_PLUGIN"),t=(e,t=!1)=>{const l=Math.round(24*(e-25569+(t?1462:0))*3600*1e3);return new Date(l)};e?.forEach(e=>{const{ranges:l=[],type:n,allowBlank:r,operator:i,formula1:a,formula2:s,showErrorMessage:o,showInputMessage:c,prompt:u,promptTitle:h,error:g,errorTitle:f,errorStyle:m}=e||{};let d=[a];isEmpty(s)||d.push(s),"list"===n&&(d=[`"${a}"`],isEmpty(s)||d.push(`"${s}"`)),"date"===n&&(d=[t(a)],isEmpty(s)||d.push(t(s)));const p=l.map(e=>this.handleRang(e)),E={type:n,allowBlank:r,operator:i,formulae:d,showErrorMessage:o,showInputMessage:c,prompt:u,promptTitle:h,error:g,errorTitle:f,errorStyle:["information","stop","warning"][m]};p.forEach(e=>{this.worksheet.dataValidations.add(e,removeEmptyAttr$1(E))})})}setImages(){const e=this.getSheetResource("SHEET_DRAWING_PLUGIN"),t=e?.data;if(t)for(const e in t){const l=t[e];let n=this.workbook.getImages().findIndex(e=>"png"===e.extension&&e.base64===l.source);-1===n&&(n=this.workbook.addImage({base64:l.source,extension:"png"}));const r=e=>({nativeCol:e.column,nativeColOff:getEmusByPx(e.columnOffset),nativeRow:e.row,nativeRowOff:getEmusByPx(e.rowOffset)});this.worksheet.addImage(n,{tl:r(l.sheetTransform.from),br:r(l.sheetTransform.to)})}}getSheetResource(e){return jsonParse(this.resources.find(t=>t.name===e)?.data)[this.sheetId]}handleRule(e){const{rule:t,stopIfTrue:l,order:n}=e,r={};switch(l&&(r.stopIfTrue=1),r.priority=n,t.style&&(r.style=cellStyle(t.style,t.style.n?.pattern,!0)),t.operator&&(r.operator=t.operator),t.type){case CFRuleType.colorScale:r.type=CFRuleType.colorScale,r.cfvo=t.config?.map(e=>({type:e.value.type,value:e.value.value})),r.color=t.config?.map(e=>({argb:hex2argb(e.color)}));break;case CFRuleType.dataBar:r.type=CFRuleType.dataBar,r.showValue=t.isShowValue,r.gradient=t.config.isGradient,r.cfvo=[{type:t.config.min.type,value:t.config.min.value},{type:t.config.max.type,value:t.config.max.value}],r.negativeFillColor={argb:hex2argb(t.config.nativeColor)},r.color={argb:hex2argb(t.config.positiveColor)},r.axisPosition="auto",r.direction="leftToRight",r.minLength=0,r.maxLength=100,r.negativeBarColorSameAsPositive=!0,r.negativeBarBorderColorSameAsPositive=!0;break;case CFRuleType.iconSet:r.type=CFRuleType.iconSet,r.reverse=!1,r.showValue=t.isShowValue,r.icons=t.config?.map(e=>({iconId:str2num(e.iconType.charAt(0))-str2num(e?.iconId)-1,iconSet:e.iconType})).reverse(),r.custom=!0,r.cfvo=t.config?.map(e=>({type:e.value.type,value:e.value.value})).reverse();break;case CFRuleType.highlightCell:switch(t.subType){case CFSubRuleType.average:r.type="aboveAverage",r.aboveAverage=!1;break;case CFSubRuleType.duplicateValues:r.type="duplicateValues";break;case CFSubRuleType.formula:r.type="expression",r.formulae=[escapeCharacter(t.value)];break;case CFSubRuleType.number:r.type="cellIs",r.formulae=[t.value];break;case CFSubRuleType.rank:r.type="top10",r.rank=t.value,r.percent=t.isPercent,r.bottom=t.isBottom;break;case CFSubRuleType.text:r.type="containsText",r.text=t.value;break;case CFSubRuleType.timePeriod:r.type="timePeriod",r.timePeriod=t.operator}}return r}}class ViewCommon{}class FrozenView{}function handleValue(e,t,l){const{sheets:n}=t,r=function(e){const{resources:t,sheetId:l,rowId:n,columnId:r}=e,i=jsonParse(t.find(e=>"SHEET_HYPER_LINK_PLUGIN"===e.name)?.data);return(i?.[l]||[]).find(e=>e.row===Number(n)&&e.column===Number(r))}(t),i=function(e,t){let l;if(e){const{payload:n}=e;let r="",i="";if(n.includes("#gid=")||n.includes("range=")){const e=n.replace("#","").split("&");r+="",1===e.length&&e[0].includes("range=")&&(r+=e[0].replace("range=")),2===e.length&&(r+=`'${function(e,t){return e[t]?.name}(t,e[0].replace("gid=",""))}'`,r+=`!${e[1].replace("range=","")}`)}else r=n,i="External";r&&(l={hyperlink:r,hyperlinkModel:i})}return l}(r,n);let a;if(e.p){const t=e.p?.body;if(e.p.drawingsOrder?.length){const t=e.p.drawings[e.p.drawingsOrder[0]],{id:n,value:r}=l.addCellImage({base64:t.source,extension:"png",descr:t.description,ext:{width:t.transform.width,height:t.transform.height}});return a={id:n,cellImageId:r,...i||{}},a}a={richText:t?.textRuns.map(e=>({text:t.dataStream.substring(e.st,e.ed),font:fontConvert(e.ts)}))}}else a=e.si?{formula:e.si,result:e.v}:e.v;if(i){const e=a?.richText?.map?.(e=>e.text)?.join("")||a?.result||a;a={text:e,...i}}return a}const Workbook=exceljs__default.default.Workbook;class WorkBook extends Workbook{constructor(e){super(),this.init(e)}init(e){this.calcProperties.fullCalcOnLoad=!0,this.setDefineNames(e.resources),function(e,t){const{sheetOrder:l,sheets:n,styles:r,resources:i}=t;l.forEach(l=>{const a=n[l],{id:s,name:o,tabColor:c,defaultRowHeight:u,defaultColumnWidth:h,hidden:g,rightToLeft:f,showGridlines:m,freeze:d,mergeData:p}=a,E=new ViewCommon;E.rightToLeft=1===f,E.showGridLines=1===m;const y=new FrozenView;(d.xSplit>0||d.ySplit>0)&&(y.state="frozen",y.xSplit=d.xSplit,y.ySplit=d.ySplit);const b=Object.assign(E,y),T=wdithConvert(h),C=heightConvert(u),I=e.addWorksheet(o,{views:[b],state:1===g?"hidden":"visible",properties:{tabColor:c?{argb:hex2argb(c)}:void 0,defaultColWidth:T,defaultRowHeight:C,dyDescent:0}});!function(e,t={},l){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n],i=e.getColumn(Number(n)+1);i.width=r.w?wdithConvert(r.w):l,i.hidden=1===r.hd}}(I,a.columnData,T),function(e,t={},l){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n],i=e.getRow(Number(n)+1);i.height=r.h?heightConvert(r.h):l,i.hidden=1===r.hd}}(I,a.rowData,C),function(e,t,l,n,r){const{resources:i,sheets:a}=n,{cellData:s,id:o}=t;for(const t in s){const n=s[t];for(const s in n){const c=n[s];if(!c)continue;const u=e.getCell(Number(t)+1,Number(s)+1);u.value=handleValue(c,{resources:i,sheetId:o,rowId:t,columnId:s,sheets:a},r);let h=c.s;"string"==typeof c.s&&(h=l[c.s]);const g=removeEmptyAttr$1(cellStyle(h,h?.n?.pattern||c.f));Object.assign(u,g)}}}(I,a,r,t,e),function(e,t){t.forEach(t=>{e.mergeCells(t.startRow+1,t.startColumn+1,t.endRow+1,t.endColumn+1)})}(I,p),new Resource(s,e,I,i)})}(this,e)}setDefineNames(e){const t=jsonParse(e.find(e=>"SHEET_DEFINED_NAME_PLUGIN"===e.name)?.data);for(const e in t){const l=t[e];this.definedNames.add(l.formulaOrRefString,l.name)}}}class CSV{constructor(e){this.csvList={},this.csvContent={},this.init(e)}init(e){if(!e)return;const{sheetOrder:t,sheets:l}=e,n={};t.forEach(e=>{const t=l[e];if(!t)return;const{cellData:r,name:i}=t,a=[];for(const e in r){const t=r[e];for(const e in t){const l=Number(e),n=Number(e);a[l]||(a[l]=[]),a[l][n]=t[e]?.v}}n[i]=a}),this.csvList=n,this.handleCsvContent()}handleCsvContent(){const e={};for(const t in this.csvList){const l=this.csvList[t];let n="data:text/csv;charset=utf-8,";l.forEach(e=>{n+=e.join(",")+"\r\n"}),e[t]=n}this.csvContent=e}}class UniverSheetBase{constructor(e){this.type=core.SheetTypes.GRID,this.tabColor="",this.hidden=0,this.freeze={xSplit:0,ySplit:0,startRow:-1,startColumn:-1},this.rowCount=100,this.columnCount=20,this.zoomRatio=1,this.scrollTop=0,this.scrollLeft=0,this.defaultColumnWidth=93,this.defaultRowHeight=27,this.mergeData=[],this.cellData={},this.rowData={},this.columnData={},this.rowHeader={width:46,hidden:0},this.columnHeader={height:20,hidden:0},this.showGridlines=1,this.rightToLeft=0,this.selections=[];const{id:t,name:l,cellData:n,rowCount:r=0,colCount:i=0}=e||{};this.id=t||"",this.name=l||"",this.cellData=n||{},this.rowCount=Math.max(this.rowCount,r),this.columnCount=Math.max(this.columnCount,i)}}function removeEmptyAttr(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?delete e[t]:isObject(e[t])&&null!==e[t]&&removeEmptyAttr(e[t]));return e}const handleStyle=(e,t,l=!1)=>{const{v:n}=e;if("string"==typeof n||null==n)return;const r={0:core.VerticalAlign.MIDDLE,1:core.VerticalAlign.TOP,2:core.VerticalAlign.BOTTOM};let i;if(t?.value&&!l){const e=e=>e?{s:e.style,cl:{rgb:e.color,th:core.ThemeColorType.DARK1}}:null;i={t:e(t.value?.t),r:e(t.value?.r),b:e(t.value?.b),l:e(t.value?.l),bl_tr:e(t.value?.bl_tr),tl_br:e(t.value?.tl_br)}}const a={0:core.WrapStrategy.CLIP,1:core.WrapStrategy.OVERFLOW,2:core.WrapStrategy.WRAP};let s;n.tr&&(s={1:45,2:135,3:255,4:90,5:180}[n.tr]),n.rt&&(s=n.rt);const o={0:core.TextDecoration.DASH,1:core.TextDecoration.SINGLE,2:core.TextDecoration.DOUBLE,3:core.TextDecoration.SINGLE,4:core.TextDecoration.DOUBLE},c={0:core.HorizontalAlign.CENTER,1:core.HorizontalAlign.LEFT,2:core.HorizontalAlign.RIGHT};return{bd:i,bg:void 0!==n.bg?{rgb:n.bg,th:core.ThemeColorType.DARK1}:void 0,bl:n.bl,cl:void 0!==n.fc?{rgb:n.fc,th:core.ThemeColorType.DARK1}:void 0,ff:n.ff,fs:n.fs,ht:void 0!==n.ht?c[n.ht]:void 0,it:n.it,n:void 0!==n.ct?.fa?{pattern:n.ct.fa}:void 0,st:void 0!==n.cl?{s:1===n.cl?core.BooleanNumber.TRUE:core.BooleanNumber.FALSE}:void 0,tb:void 0!==n.tb?a[n.tb]:void 0,tr:void 0!==s?{a:s,v:n.tr||n.rt?core.BooleanNumber.TRUE:core.BooleanNumber.FALSE}:void 0,ul:void 0!==n.un?{s:void 0===n.un?core.BooleanNumber.FALSE:core.BooleanNumber.TRUE,t:n.un?o[n.un]:core.TextDecoration.DASH}:void 0,vt:void 0!==n.vt?r[n.vt]:void 0}};var ImageSourceType;!function(e){e.URL="URL",e.UUID="UUID",e.BASE64="BASE64"}(ImageSourceType||(ImageSourceType={}));class UniverSheet extends UniverSheetBase{constructor(e){super(),this.hyperLink=[],this.handleMerge=e=>{const t=e.merge;return t?Object.values(t).map(e=>({startRow:e.r,endRow:e.r+e.rs-1,startColumn:e.c,endColumn:e.c+e.cs-1})):[]},this.handleCellData=(e,t)=>{const l=e=>{const{v:l}=e;if("string"==typeof l||null==l)return{v:l};const n={s:core.CellValueType.STRING,n:core.CellValueType.NUMBER,b:core.CellValueType.BOOLEAN,str:core.CellValueType.STRING},r=t.borderInfo?.find(t=>t.value.col_index===e.c&&t.value.row_index===e.r);let i=l.ct?.t&&n[l.ct?.t]?n[l.ct?.t]:core.CellValueType.NUMBER,a=i===core.CellValueType.NUMBER?str2num(l.v):l.v;i===core.CellValueType.BOOLEAN&&(a="1"==l.v?1:0),Number.isNaN(Number(a))&&i===core.CellValueType.NUMBER&&(i=core.CellValueType.STRING),this.hyperLink.findIndex(t=>t.column===e.c&&t.row===e.r)>-1&&(i=core.CellValueType.STRING);const s=l.f?.replace(/=_xlfn./g,"="),o={f:s,s:handleStyle(e,r),t:i,v:a},c=this.handleDocument(e,t);c&&(o.p=c);const u=this.handleCellImage(e,t);return u&&(o.p=u,o.f=void 0,o.v=void 0),removeEmptyAttr(o)};let n,r=0;const i=e.reduce((e,t)=>(n===t.r?e[t.r].push(t):(n=t.r,e[n]=[t]),t.c>r&&(r=t.c),e),[]),a={};return i.forEach((e,t)=>{for(let n=0;n<r+1;n++){const r=e.find(e=>e.c===n)||{r:t,c:n,v:null};a[r.r]||(a[r.r]={}),a[r.r][r.c]=l(r)}}),{cellData:a,rowCount:i.length,colCount:r}},this.handleDocument=(e,t)=>{const l=(e,t)=>{const l=new RegExp(t,"g");let n;const r=[];for(;n=l.exec(e);)r.push(n.index);return r};let n=null;const{v:r}=e;if("string"!=typeof r&&null!=r){if(r.ct&&"inlineStr"===r.ct.t){r.ct.s=r.ct.s?.map(e=>(e.v=(e=>{const t=new RegExp("\r\n","g");return e.replace(t,"\r")})(e.v||""),e))||[];let i=r.ct.s.reduce((e,t)=>e+t.v,"");i=i?i.replace(/\n/g,"\r")+"\r\n":"";const a={r:"\r",n:"\n",v:"\v",f:"\f",0:"\0",t:"\t",b:"\b",x1A:"\x1a",x1B:"\x1b",x1C:"\x1c",x1D:"\x1d",x1E:"\x1e",x1F:"\x1f"},s=l(i,a.r).map(e=>({startIndex:e})),o=l(i,a.n).map(e=>({startIndex:e})),c=r.ct.s.map((l,n)=>{const i=r.ct.s.reduce((e,t,l)=>l<n?e+(t.v?.length||0):e,0),a=i+(r.ct.s?.[n]?.v?.length||0),s=t.borderInfo?.find(t=>t.value.col_index===e.c&&t.value.row_index===e.r);return{st:i,ed:a,ts:handleStyle({v:r.ct.s[n]||r.ct.s[0],r:e.r,c:e.c},s,!0)}});n={id:generateRandomId(6),documentStyle:{documentFlavor:0,pageSize:{width:0,height:0},renderConfig:{},textStyle:{}},body:{dataStream:i,paragraphs:s,sectionBreaks:o,textRuns:c},drawings:{}}}return n}},this.handleCellImage=(e,t)=>{let l=null;const{v:n}=e;if("string"!=typeof n&&null!=n){if(n.ct&&"str"===n.ct.t&&n.ct.ci){const r=generateRandomId(6),i=generateRandomId(6),{default:a,src:s,descr:o}=n.ct.ci||{},c=t.borderInfo?.find(t=>t.value.col_index===e.c&&t.value.row_index===e.r);l={id:i,documentStyle:{documentFlavor:0,pageSize:{width:0,height:0},renderConfig:{},textStyle:{}},body:{dataStream:"\b\r\n",paragraphs:[{startIndex:1,paragraphStyle:{horizontalAlign:n.ht}}],sectionBreaks:[{startIndex:2}],textRuns:[{ed:1,st:0,ts:handleStyle({v:n,r:e.r,c:e.c},c,!0)}],customBlocks:[{startIndex:0,blockId:r}]},drawings:{[r]:{unitId:i,subUnitId:i,drawingId:r,layoutType:core.PositionedObjectLayoutType.INLINE,title:"",description:o,docTransform:{size:{width:a.width,height:a.height},positionH:{relativeFrom:0,posOffset:0},positionV:{relativeFrom:1,posOffset:0},angle:0},drawingType:core.DrawingTypeEnum.DRAWING_IMAGE,imageSourceType:ImageSourceType.BASE64,source:s,transform:a}},drawingsOrder:[r]}}return l}},this.handleRowAndColumnData=e=>{const t={},l={};for(let t=0;t<this.rowCount;t++)l[t]={h:e.rowlen?.[t]||this.defaultRowHeight,ia:e.rowlen?.[t]?core.BooleanNumber.FALSE:core.BooleanNumber.TRUE,ah:this.defaultRowHeight,hd:0===e.rowhidden?.[t]?core.BooleanNumber.TRUE:core.BooleanNumber.FALSE};for(let l=0;l<this.columnCount;l++)t[l]={w:e.columnlen?.[l]||this.defaultColumnWidth,hd:0===e.colhidden?.[l]?core.BooleanNumber.TRUE:core.BooleanNumber.FALSE};this.rowData=l,this.columnData=t},this.handleSheetLink=e=>{if(!e)return;const t=Object.keys(e).map(t=>{const l=t.split("_")[0],n=t.split("_")[1],r=e[t];let i=r.linkAddress;if("internal"===r.linkType){const e=r.linkAddress.split("!");i={},e[0]&&(i.gid=e[0]),e[1]&&(i.range=e[1])}return{id:generateRandomId(6),row:Number(l),column:Number(n),payload:i}});this.hyperLink=t},this.handleFreeze=e=>{this.freeze={xSplit:e.vertical,ySplit:e.horizen,startColumn:e.vertical,startRow:e.horizen}};const{color:t,zoomRatio:l,celldata:n,config:r={},showGridLines:i,defaultColWidth:a,defaultRowHeight:s,hide:o}=e||{};if(this.name=e.name,this.id=`sheet-${e.index}`,e){if(this.tabColor=t,this.zoomRatio=l,this.showGridlines=Number(i),this.defaultColumnWidth=a,this.defaultRowHeight=s,this.hidden=o,this.handleSheetLink(e.hyperlink),r.merge&&(this.mergeData=this.handleMerge(r)),n?.length){const{cellData:e,rowCount:t,colCount:l}=this.handleCellData(n,r);this.cellData=e,this.rowCount=this.rowCount>t?this.rowCount:t+1,this.columnCount=this.columnCount>l?this.columnCount:l+1}this.handleRowAndColumnData(r),e.freezen&&this.handleFreeze(e.freezen)}}get mode(){return{id:this.id,name:this.name,type:this.type,tabColor:this.tabColor,hidden:this.hidden,freeze:this.freeze,rowCount:this.rowCount,columnCount:this.columnCount,zoomRatio:this.zoomRatio,scrollTop:this.scrollTop,scrollLeft:this.scrollLeft,defaultColumnWidth:this.defaultColumnWidth,defaultRowHeight:this.defaultRowHeight,mergeData:this.mergeData,cellData:this.cellData,rowData:this.rowData,columnData:this.columnData,rowHeader:this.rowHeader,columnHeader:this.columnHeader,showGridlines:this.showGridlines,rightToLeft:this.rightToLeft,selections:this.selections,hyperLink:this.hyperLink}}}class UniverWorkBook{constructor(e){this.resources=[],this.handleHyperLinks=e=>{const t={};for(const l in e){const n=e[l].hyperLink;n?.length&&(t[l]=n.map(t=>{let l=t.payload;if("string"!=typeof t.payload){l="#";const n=t.payload.gid.replace(/'|"/g,""),r=Object.values(e).find(e=>e.name===n)?.id;n&&r&&(l+=`gid=${r}`),n&&r&&t.payload.range&&(l+="&"),t.payload.range&&(l+=`range=${t.payload.range}`)}return{...t,payload:l}}))}this.resources?.push({name:"SHEET_HYPER_LINK_PLUGIN",data:JSON.stringify(t)})},this.handleImage=(e,t)=>{const l={};Object.values(e).forEach(e=>{const n=t.find(t=>t.name===e.name)?.images;if(!n)return;const r=Object.keys(n),i={};r.forEach(t=>{const l=n[t];e.columnCount<l.toCol&&(e.columnCount=l.toCol+1),e.rowCount<l.toRow&&(e.rowCount=l.toRow+1);let r={unitId:this.id,subUnitId:e.id||"",drawingId:t,transform:{width:0,height:0,scaleX:0,scaleY:0,left:0,top:0,angle:0,skewX:0,skewY:0,flipX:!1,flipY:!1,...l.transform||{}},sheetTransform:{angle:0,skewX:0,skewY:0,flipX:!1,flipY:!1,from:{column:l.fromCol,columnOffset:l.fromColOff,row:l.fromRow,rowOffset:l.fromRowOff},to:{column:l.toCol,columnOffset:l.toColOff,row:l.toRow,rowOffset:l.toRowOff}}};r="chart"===l.type?{...r,drawingType:core.DrawingTypeEnum.DRAWING_CHART,componentKey:"Chart",data:{...l.data||{},range:`${e.name}!${l.data.range}`},allowTransform:!0}:{...r,drawingType:core.DrawingTypeEnum.DRAWING_IMAGE,imageSourceType:ImageSourceType.BASE64,source:l.src,prstGeom:"rect",anchorType:"1"},i[t]=r}),l[e.id]={data:i,order:r}}),this.resources?.push({name:"SHEET_DRAWING_PLUGIN",data:JSON.stringify(l)})},this.handleChart=(e,t)=>{const l={};Object.values(e).forEach(e=>{const n=t.find(t=>t.name===e.name)?.charts;n&&n.forEach(t=>{l[e.id]||(l[e.id]=[]),l[e.id].push({rangeInfo:{isRowDirection:t.isRowDirection,rangeInfo:{unitId:this.id,subUnitId:e.id||"",range:handleRanges(t.range)[0]}},id:t.id,chartType:t.chartType,context:t.context,style:t.style,dataAggregation:{}})})}),this.resources?.push({name:"SHEET_CHART_PLUGIN",data:JSON.stringify(l)})},this.handleNames=e=>{this.resources?.push({name:"SHEET_DEFINED_NAME_PLUGIN",data:JSON.stringify(e.defineNames)})},this.handleCondition=e=>{const t={};Object.keys(e).forEach(l=>{const n=e[l].conditionalFormatting?.map(e=>(e.rule?.style&&(e.rule.style=handleStyle({v:e.rule.style,r:0,c:0},{value:e.rule?.style?.border,rangeType:""})),e));t[l]=n}),this.resources?.push({name:"SHEET_CONDITIONAL_FORMATTING_PLUGIN",data:JSON.stringify(t)})},this.handleVerification=e=>{const t={};Object.keys(e).forEach(l=>{t[l]=e[l].dataVerificationList}),this.resources?.push({name:"SHEET_DATA_VALIDATION_PLUGIN",data:JSON.stringify(t)})},this.handleFilter=e=>{const t={};Object.keys(e).forEach(l=>{t[l]=e[l].filter}),this.resources?.push({name:"SHEET_FILTER_PLUGIN",data:JSON.stringify(t)})};const{info:t,sheets:l,workbook:n}=e;this.id=generateRandomId(6),this.name=t.name,this.appVersion=t.appversion,this.locale=core.LocaleType.ZH_CN;const r={},i=[],a={};l.sort((e,t)=>Number(e.order)-Number(t.order)).forEach(e=>{const t=new UniverSheet(e);r[t.id]=t.mode,a[t.id]=e,i.push(t.id)}),this.handleHyperLinks(r),this.handleImage(r,l),this.handleChart(r,l),this.handleNames(n),this.handleCondition(a),this.handleVerification(a),this.handleFilter(a),this.sheetOrder=i,this.sheets=r}get mode(){return{id:this.id,rev:this.rev,name:this.name,appVersion:this.appVersion,locale:this.locale,styles:this.styles,sheetOrder:this.sheetOrder,sheets:this.sheets,resources:this.resources}}}class UniverCsvWorkBook{constructor(e){const t={};let l=0,n=0;e.forEach((e,r)=>{r+1>l&&(l=r+1),e.forEach((e,l)=>{l+1>n&&(n=l+1),t[r]||(t[r]={}),t[r][l]={v:e||""}})});const r="sheet1",i=new UniverSheetBase({id:r,name:r,cellData:t,rowCount:l,colCount:n});this.sheets={[r]:i},this.sheetOrder=[r],this.id=generateRandomId(6),this.name=this.id}get mode(){return{id:this.id,rev:this.rev,name:this.name,appVersion:this.appVersion,locale:this.locale,styles:this.styles,sheetOrder:this.sheetOrder,sheets:this.sheets,resources:this.resources}}}module.exports=class{constructor(){}static transformExcelToLucky(e,t,l){new HandleZip(e).unzipFile(function(l){let n=new LuckyFile(l,e.name).Parse(),r=JSON.parse(n);null!=t&&t(r,n)},function(e){l&&l(e)})}static transformExcelToLuckyByUrl(e,t,l,n){(new HandleZip).unzipFileByUrl(e,function(e){let n=new LuckyFile(e,t).Parse(),r=JSON.parse(n);null!=l&&l(r,n)},function(e){n&&n(e)})}static transformExcelToUniver(e,t,l){new HandleZip(e).unzipFile(function(n){try{let l=new LuckyFile(n,e.name).Parse(),r=JSON.parse(l);const i=500;if(r.sheets.forEach(e=>{const t=e.data||[],l=[];for(let e=0;e<t.length;e+=i)l.push(t.slice(e,e+i));e.dataChunks=l}),t){const e=new UniverWorkBook(r);t(e.mode,{raw:l,chunks:r.sheets.map(e=>({id:e.id,name:e.name,chunks:e.dataChunks}))})}}catch(e){l?.(e)}},function(e){l&&l(e)})}static transformCsvToUniver(e,t,l){try{(({file:e,charset:t=CHARSET_TYPE.UTF8})=>new Promise((l,n)=>{e instanceof File||l("");const r=new FileReader;r.onload=e=>{try{const{result:t}=e.target;l(t)}catch(e){n(e)}},r.readAsText(e,t)}))({file:e}).then(n=>{try{const l=((e,t)=>{const l=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n");let n=[];if(t.name.endsWith(".csv")||"text/csv"===t.type)n=Papa__default.default.parse(e,{delimiter:",",skipEmptyLines:!0}).data;else for(let e=0;e<l.length;e++){const t=l[e].replace(/\r/,"");t&&n.push(t.split(","))}return n})(n,e),r=500,i=[];for(let e=0;e<l.length;e+=r)i.push(l.slice(e,e+r));const a=new UniverCsvWorkBook(l||[]);t?.(a.mode,{full:l,chunks:i})}catch(e){l?.(e)}})}catch(e){l?.(e)}}static async transformUniverToExcel(e){const{snapshot:t,fileName:l=`excel_${(new Date).getTime()}.xlsx`,getBuffer:n=!1,success:r,error:i}=e;try{const e=new WorkBook(t),i=await e.xlsx.writeBuffer();n?r?.(i):(this.downloadFile(l,i),r?.())}catch(e){i?.(e)}}static async transformUniverToCsv(e){const{snapshot:t,fileName:l=`csv_${(new Date).getTime()}.csv`,getBuffer:n=!1,success:r,error:i,sheetName:a}=e;try{const e=new CSV(t);let i;if(i=a?e.csvContent[a]:e.csvContent,n)r?.(i);else{if(isObject(i)){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e)){const t=i[e];this.downloadFile(`${l}_${e}`,t)}}else this.downloadFile(l,i);r?.()}}catch(e){i(e)}}static downloadFile(e,t){const l=document.createElement("a");let n;n="string"==typeof t?new Blob([t],{type:"text/csv;charset=utf-8;"}):new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});const r=URL.createObjectURL(n);l.href=r,l.download=e,document.body.appendChild(l),l.click(),l.addEventListener("click",()=>{l.remove(),setTimeout(()=>{URL.revokeObjectURL(r)},200)})}};
